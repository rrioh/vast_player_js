(()=>{"use strict";function e(e,t,r){if(!t)return;new Date;let n=document.createElement("img");t=r(t,null),n.src=t,n.style.display="none",e.prepend(n),console.log("[DEBUG] beacon sent: "+t)}function t(e,t){if(e)for(let r of e){let e=document.createElement("img");e.src=r.replace(/\[ERRORCODE\]/,t.toString()),e.style.display="none",document.body.prepend(e),console.log("[DEBUG] error beacon sent: "+r)}}var r;function n(e){let t=e.match(/(\d{2}):(\d{2}):(\d{2})/);if(!t||t.length<4||NaN===parseInt(t[1])||NaN===parseInt(t[2])||NaN===parseInt(t[3]))throw new Error("convertdurationToSecond error: "+e);return 60*parseInt(t[1])*60+60*parseInt(t[2])+parseFloat(t[3])}!function(e){e[e.XMLParseError=100]="XMLParseError",e[e.VASTSchemaValidationError=101]="VASTSchemaValidationError",e[e.VASTVersionOfResponseNotSupported=102]="VASTVersionOfResponseNotSupported",e[e.NonPlayableAdType=200]="NonPlayableAdType",e[e.MediaPlayerExpectingDifferentLinearity=201]="MediaPlayerExpectingDifferentLinearity",e[e.MediaPlayerExpectingDifferentDuration=202]="MediaPlayerExpectingDifferentDuration",e[e.MediaPlayerExpectingDifferentSize=203]="MediaPlayerExpectingDifferentSize",e[e.AdCategoryNotProvided=204]="AdCategoryNotProvided",e[e.InlineCategoryViolatesWrapperBlockedAdCategories=205]="InlineCategoryViolatesWrapperBlockedAdCategories",e[e.AdNotServed=206]="AdNotServed",e[e.GeneralWrapperError=300]="GeneralWrapperError",e[e.VASTURIUnavailableOrTimeout=301]="VASTURIUnavailableOrTimeout",e[e.WrapperLimitReached=302]="WrapperLimitReached",e[e.NoVASTResponseAfterWrapper=303]="NoVASTResponseAfterWrapper",e[e.AdUnitNotDisplayed=304]="AdUnitNotDisplayed",e[e.GeneralLinearError=400]="GeneralLinearError",e[e.FileNotFound=401]="FileNotFound",e[e.MediaFileURITimeout=402]="MediaFileURITimeout",e[e.SupportedMediaFileNotFound=403]="SupportedMediaFileNotFound",e[e.ProblemDisplayingMediaFile=405]="ProblemDisplayingMediaFile",e[e.MezzanineNotProvided=406]="MezzanineNotProvided",e[e.MezzanineDownloading=407]="MezzanineDownloading",e[e.ConditionalAdRejected=408]="ConditionalAdRejected",e[e.InteractiveUnitNotExecuted=409]="InteractiveUnitNotExecuted",e[e.VerificationUnitNotExecuted=410]="VerificationUnitNotExecuted",e[e.NotRequiredSpecificationOfMezzanine=411]="NotRequiredSpecificationOfMezzanine",e[e.GeneralNonLinearAdsError=500]="GeneralNonLinearAdsError",e[e.NonLinearAdNonDisplayable=501]="NonLinearAdNonDisplayable",e[e.UnableToFetchNonLinearResource=502]="UnableToFetchNonLinearResource",e[e.SupportedNonLinearResourceNotFound=503]="SupportedNonLinearResourceNotFound",e[e.GeneralCompanionAdsError=600]="GeneralCompanionAdsError",e[e.CompanionNonDisplayableByDimemsionError=601]="CompanionNonDisplayableByDimemsionError",e[e.RequiredCompanionNonDisplayable=602]="RequiredCompanionNonDisplayable",e[e.UnableToFetchNonCompanionResource=603]="UnableToFetchNonCompanionResource",e[e.SupportedCompanionResourceNotFound=604]="SupportedCompanionResourceNotFound",e[e.UndefinedError=900]="UndefinedError",e[e.GeneralVPAIDError=901]="GeneralVPAIDError",e[e.GeneralInteractiveCreativeFileError=902]="GeneralInteractiveCreativeFileError"}(r||(r={}));const o=new Map([["start",0],["firstQuartile",1/4],["midpoint",.5],["thirdQuartile",3/4],["complete",1]]),i=new class{errorUrls;constructor(){this.errorUrls=[]}isWrapper(e){return!!e.querySelector(":scope>Ad>Wrapper")}async nextVast(e){const t=e.querySelector(":scope>Ad>Wrapper>VASTAdTagURI");if(!t||!t.textContent)throw new Error("next vast url error");let r=t.textContent;const n=await fetch(r);return await n.text()}async parseVast(e){try{let t=this.parseVastXML(e);for(let r=1;r<=5&&this.isWrapper(t);r++){if(5==r)throw new Error("too many wrapper");e=await this.nextVast(t),t=this.parseVastXML(e)}return this.createVastObject(t)}catch(e){return console.log("[ERROR] cannot create VASTObject: "+e),null}}parseVastXML(e){let t=(new DOMParser).parseFromString(e,"application/xml"),r=t.querySelector("parsererror");if(r)throw new Error(r.textContent||"parse vast error");let n=t.querySelector("VAST");if(!n)throw new Error("VAST tag not found");return n}createVastObject(e){const o=e.querySelector(":scope>Error");o&&o.textContent&&this.errorUrls.push(o.textContent);const i=e.querySelector(":scope>Ad>InLine");if(!i)throw t(this.errorUrls,r.NoVASTResponseAfterWrapper),new Error("parse InLine error");const a=i.querySelector(":scope>Error");a&&a.textContent&&this.errorUrls.push(a.textContent);const s=i.querySelector(":scope>Impression");if(!s||!s.textContent)throw t(this.errorUrls,r.XMLParseError),new Error("parse InLine Impression error");const l=s.textContent,c=i.querySelector(":scope>AdTitle");if(!c||!c.textContent)throw t(this.errorUrls,r.XMLParseError),new Error("parse InLine AdTitle error");const d=c.textContent;let p=null;const u=i.querySelector(":scope>Description");u&&u.textContent&&(p=u.textContent);const h=i.querySelector(":scope>Creatives>Creative>Linear");if(!h)throw t(this.errorUrls,r.XMLParseError),new Error("parse InLine Linear error");const f=h.querySelector(":scope>Duration");if(!f||!f.textContent)throw t(this.errorUrls,r.XMLParseError),new Error("parse InLine Linear Duration error");const E=n(f.textContent),y=h.querySelectorAll(":scope>TrackingEvents>Tracking"),g=this.createTrackingObject(y,E),m=h.querySelectorAll(":scope>Icons>Icon"),x=this.createIconObject(m),A=h.querySelectorAll(":scope>MediaFiles>MediaFile");if(!A)throw t(this.errorUrls,r.XMLParseError),new Error("parse MediaFiles error");const C=A[0]?.textContent,T=h.querySelector(":scope>VideoClicks");let v=null,S=[];if(T){const e=T.querySelector(":scope>ClickThrough");if(!e||!e.textContent)throw t(this.errorUrls,r.XMLParseError),new Error("parse InLine Linear ClickThrough error");v=e.textContent;const n=T.querySelectorAll(":scope>ClickTracking");for(let e of n)e.textContent&&S.push(e.textContent)}return{errorUrls:this.errorUrls,impressionUrls:[l],adTitle:d,adDesc:p,trackings:g,icons:x,mediaFileUrl:C,clickThroughUrl:v,clickTrackingUrls:S}}createTrackingObject(e,t){const r=new Map;return e.forEach((function(e){if(!e.textContent)return;const i=e.getAttribute("event");if(i)if("progress"===i){const t=e.getAttribute("offset");if(!t)return;const o=n(t);r.set(o,e.textContent)}else{const n=o.get(i);null!=n?r.set(n*t,e.textContent):r.set(i,e.textContent)}})),r}createIconObject(e){let t=[];for(let r of e){let e=r,o=parseInt(e.getAttribute("width")||"10")||10,i=parseInt(e.getAttribute("height")||"10")||10,a="0px",s=e.getAttribute("xPosition");s&&(a="left"===s||"right"===s?s:s+"px");let l="0px",c=e.getAttribute("yPosition");c&&(l="top"===c||"bottom"===c?c:c+"px");let d=e.getAttribute("offset"),p=0;d&&(p=n(d));let u=e.getAttribute("duration"),h=null;u&&(h=n(u)+p);const f=e.querySelector(":scope>StaticResource");if(!f||!f.textContent)continue;const E=e.querySelector(":scope>IconClicks>IconClickThrough"),y=e.querySelector(":scope>IconClicks>IconClickTracking");t.push({width:o,height:i,xPosition:a,yPosition:l,start:p,end:h,imgUrl:f.textContent,clickThroughUrl:E?.textContent??null,clickTrackingUrl:y?.textContent??null})}return t}},a=new class{async startPlayer(t){console.log("setPlayer started...");const r=await i.parseVast('\n<VAST version="4.2">\n  <Error>\n    <![CDATA[http://test.example/error?code=[ERRORCODE]&clientTime=[TIMESTAMP]]]>\n  </Error>\n  <Ad id="1b330e59-3a62-4000-b9fb-ac9726e98c52" sequence="1">\n    <Wrapper>\n      <VASTAdTagURI>\n        <![CDATA[http://localhost:8080/sample/inline.html]]>\n      </VASTAdTagURI>\n    </Wrapper>\n  </Ad>\n</VAST>\n');if(!r)return;let n=document.createElement("iframe");n.width="300px",n.height="250px",n.style.border="none",document.getElementById("playerbox")?.appendChild(n);let o=n.contentWindow.document;o.open(),o.write('\n<!DOCTYPE html>\n<html>\n    <head>\n    </head>\n    <body style="margin:0;">\n        <div id="vast_video_container">\n            <div id="vast_video" style="width:300px;height:168.75px;"></div>\n            <div id="progress_bar" style="width:50%;height:3px;background-color:gray;"></div>\n            <div id="ad_text" style="margin:0;width:300px;height:78.25px;background-color:#dcdcdc;">\n                <div id="ad_title" style="font-size:15px;font-weight:bold;"></div>\n                <div id="ad_desc" style="font-size:10px;"></div>\n            </div>\n        </div>\n    </body>\n</html>\n'),o.close(),o.documentElement.style.overflow="hidden",o.getElementById("ad_title").textContent=r.adTitle;let a=o.getElementById("ad_desc");r.adDesc&&(a.textContent=r.adDesc);let s=o.getElementById("vast_video"),l=document.createElement("video");l.src=r.mediaFileUrl,l.style.width="100%",l.style.height="100%",l.muted=!0,l.autoplay=!0,l.addEventListener("loadedmetadata",(function(e){let t=o.getElementById("progress_bar"),r=function(){let e=l.currentTime/l.duration*100;t.style.width=e+"%",requestAnimationFrame(r)};requestAnimationFrame(r)}));const c=function(e){let t=new Map;t.set("[TIMESTAMP]",(()=>(new Date).toISOString()));const r={ratio:0};return new IntersectionObserver((function(e){e.forEach((function(e){const t=Math.floor(100*e.intersectionRatio)/100;r.ratio=t}))}),{rootMargin:"0px",threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}).observe(e),t.set("[INVIEW_RATIO]",function(e){return()=>e.ratio.toFixed(2)}(r)),(e,r)=>(console.log("REPLACE MAP:"),console.log(t),r&&t.set("[ERRORCODE]",r.toString()),t.forEach(((t,r)=>{console.log("REPLACER KEY: "+r),console.log("REPLACER VALUE: "),console.log(t),e=e.replace(r,"function"==typeof t?t():t)})),e)}(s);(function(t,r,n){!function(t,r,n){for(let o of r)t.addEventListener("canplay",(function(r){e(t,o,n)}),{once:!0})}(t,r.impressionUrls,n),function(e,t){t&&e.addEventListener("click",(function(e){open(t,"_blank")}))}(t,r.clickThroughUrl),function(t,r,n){for(let o of r)t.addEventListener("click",(function(r){e(t,o,n)}))}(t,r.clickTrackingUrls,n),function(t,r,n){t.addEventListener("loadedmetadata",(function(o){for(let[o,i]of r.trackings)"loaded"==o?t.addEventListener("canplay",(function(r){e(t,i,n)}),{once:!0}):"pause"===o?t.addEventListener("pause",(function(r){e(t,i,n)})):"number"==typeof o&&t.addEventListener("timeupdate",(function r(a){t.currentTime>=o&&(e(t,i,n),t.removeEventListener("timeupdate",r))}))}))}(t,r,n)})(l,r,c),function(t,r,n,o){for(let i of n.icons){let n=document.createElement("img");n.src=i.imgUrl,n.width=i.width,n.height=i.height,n.style.position="fixed","left"===i.xPosition?n.style.left="0px":"right"===i.xPosition?n.style.right="0px":n.style.left=i.xPosition,"top"===i.yPosition?n.style.top="0px":"bottom"===i.yPosition?n.style.bottom="0px":n.style.top=i.yPosition,n.addEventListener("click",(function(r){i.clickTrackingUrl&&e(t,i.clickTrackingUrl,o),i.clickThroughUrl&&open(i.clickThroughUrl,"_blank")})),t.addEventListener("timeupdate",(function e(o){!r.contains(n)&&t.currentTime>=i.start&&r.appendChild(n),i.end&&r.contains(n)&&t.currentTime>=i.end&&(r.removeChild(n),t.removeEventListener("timeupdate",e))})),i.end||t.addEventListener("ended",(function(e){r.contains(n)&&r.removeChild(n)}))}}(l,s,r,c),new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting?l.play():l.pause()}))}),{rootMargin:"0px",threshold:.5}).observe(l),s.appendChild(l)}};window.vastExecutor=window.vastExecutor||a})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UXZELFNBQVEsU0FBVXdELEdBQ2xCQSxFQUFNOEIsZUFDTjlDLEVBQU0rQyxPQUdOL0MsRUFBTWdELGFBVkYsQ0FDWjVCLFdBQVksTUFDWkMsVUFBVyxLQWFOQyxRQUFRdEIsR0FDakJELEVBQWFULFlBQVlVLEtBSWpDaUQsT0FBT2hFLGFBQWVnRSxPQUFPaEUsY0FBZ0JBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92YXN0X3BsYXllcl9qcy8uL2xpYi9kb21haW4vc2VydmljZS9iZWFjb24udHMiLCJ3ZWJwYWNrOi8vdmFzdF9wbGF5ZXJfanMvLi9saWIvdXRpbC9tYWNyby50cyIsIndlYnBhY2s6Ly92YXN0X3BsYXllcl9qcy8uL2xpYi91dGlsL3RpbWUudHMiLCJ3ZWJwYWNrOi8vdmFzdF9wbGF5ZXJfanMvLi9saWIvZG9tYWluL3NlcnZpY2UvdmFzdC50cyIsIndlYnBhY2s6Ly92YXN0X3BsYXllcl9qcy8uL3NyYy9tYWluLnRzIiwid2VicGFjazovL3Zhc3RfcGxheWVyX2pzLy4vbGliL2RvbWFpbi9zZXJ2aWNlL2ljb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gc2V0SW1wcmVzc2lvblVybCh2aWRlbywgdXJscywgbWFjcm9SZXBsYWNlcikge1xuICAgIGZvciAobGV0IHVybCBvZiB1cmxzKSB7XG4gICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBjcmVhdGVCZWFjb24odmlkZW8sIHVybCwgbWFjcm9SZXBsYWNlcik7XG4gICAgICAgIH0sIHsgb25jZTogdHJ1ZSB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRWaWRlb0NsaWNrVGhyb3VnaFVybCh2aWRlbywgdXJsKSB7XG4gICAgaWYgKCF1cmwpXG4gICAgICAgIHJldHVybjtcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgb3Blbih1cmwsIFwiX2JsYW5rXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2V0VmlkZW9DbGlja1RyYWNraW5nVXJscyh2aWRlbywgdXJscywgbWFjcm9SZXBsYWNlcikge1xuICAgIGZvciAobGV0IHVybCBvZiB1cmxzKSB7XG4gICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgY3JlYXRlQmVhY29uKHZpZGVvLCB1cmwsIG1hY3JvUmVwbGFjZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRUcmFja2luZ1VybHModmlkZW8sIHZhc3RPYmplY3QsIG1hY3JvUmVwbGFjZXIpIHtcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkbWV0YWRhdGFcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZm9yIChsZXQgW3BvaW50LCB1cmxdIG9mIHZhc3RPYmplY3QudHJhY2tpbmdzKSB7XG4gICAgICAgICAgICBpZiAocG9pbnQgPT0gXCJsb2FkZWRcIikge1xuICAgICAgICAgICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZUJlYWNvbih2aWRlbywgdXJsLCBtYWNyb1JlcGxhY2VyKTtcbiAgICAgICAgICAgICAgICB9LCB7IG9uY2U6IHRydWUgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwb2ludCA9PT0gXCJwYXVzZVwiKSB7XG4gICAgICAgICAgICAgICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInBhdXNlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZUJlYWNvbih2aWRlbywgdXJsLCBtYWNyb1JlcGxhY2VyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBwb2ludCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJ0aW1ldXBkYXRlXCIsIGZ1bmN0aW9uIHRpbWVCZWFjb25FdmVudChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWRlby5jdXJyZW50VGltZSA+PSBwb2ludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQmVhY29uKHZpZGVvLCB1cmwsIG1hY3JvUmVwbGFjZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgdGltZUJlYWNvbkV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQmVhY29uKHBhcmVudCwgdXJsLCBtYWNyb1JlcGxhY2VyKSB7XG4gICAgaWYgKCF1cmwpXG4gICAgICAgIHJldHVybjtcbiAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgdXJsID0gbWFjcm9SZXBsYWNlcih1cmwsIG51bGwpO1xuICAgIGVsZS5zcmMgPSB1cmw7XG4gICAgZWxlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBwYXJlbnQucHJlcGVuZChlbGUpO1xuICAgIGNvbnNvbGUubG9nKFwiW0RFQlVHXSBiZWFjb24gc2VudDogXCIgKyB1cmwpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNlbmRFcnJvcih1cmxzLCBlcnJvckNvZGUpIHtcbiAgICBpZiAoIXVybHMpXG4gICAgICAgIHJldHVybjtcbiAgICBmb3IgKGxldCB1cmwgb2YgdXJscykge1xuICAgICAgICBsZXQgZWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgICAgZWxlLnNyYyA9IHVybC5yZXBsYWNlKC9cXFtFUlJPUkNPREVcXF0vLCBlcnJvckNvZGUudG9TdHJpbmcoKSk7XG4gICAgICAgIGVsZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucHJlcGVuZChlbGUpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIltERUJVR10gZXJyb3IgYmVhY29uIHNlbnQ6IFwiICsgdXJsKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gc2V0QmVhY29ucyh2aWRlbywgdmFzdE9iamVjdCwgbWFjcm9SZXBsYWNlcikge1xuICAgIHNldEltcHJlc3Npb25VcmwodmlkZW8sIHZhc3RPYmplY3QuaW1wcmVzc2lvblVybHMsIG1hY3JvUmVwbGFjZXIpO1xuICAgIHNldFZpZGVvQ2xpY2tUaHJvdWdoVXJsKHZpZGVvLCB2YXN0T2JqZWN0LmNsaWNrVGhyb3VnaFVybCk7XG4gICAgc2V0VmlkZW9DbGlja1RyYWNraW5nVXJscyh2aWRlbywgdmFzdE9iamVjdC5jbGlja1RyYWNraW5nVXJscywgbWFjcm9SZXBsYWNlcik7XG4gICAgc2V0VHJhY2tpbmdVcmxzKHZpZGVvLCB2YXN0T2JqZWN0LCBtYWNyb1JlcGxhY2VyKTtcbn1cbiIsImV4cG9ydCB2YXIgRXJyb3JDb2RlO1xuKGZ1bmN0aW9uIChFcnJvckNvZGUpIHtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiWE1MUGFyc2VFcnJvclwiXSA9IDEwMF0gPSBcIlhNTFBhcnNlRXJyb3JcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiVkFTVFNjaGVtYVZhbGlkYXRpb25FcnJvclwiXSA9IDEwMV0gPSBcIlZBU1RTY2hlbWFWYWxpZGF0aW9uRXJyb3JcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiVkFTVFZlcnNpb25PZlJlc3BvbnNlTm90U3VwcG9ydGVkXCJdID0gMTAyXSA9IFwiVkFTVFZlcnNpb25PZlJlc3BvbnNlTm90U3VwcG9ydGVkXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIk5vblBsYXlhYmxlQWRUeXBlXCJdID0gMjAwXSA9IFwiTm9uUGxheWFibGVBZFR5cGVcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiTWVkaWFQbGF5ZXJFeHBlY3RpbmdEaWZmZXJlbnRMaW5lYXJpdHlcIl0gPSAyMDFdID0gXCJNZWRpYVBsYXllckV4cGVjdGluZ0RpZmZlcmVudExpbmVhcml0eVwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJNZWRpYVBsYXllckV4cGVjdGluZ0RpZmZlcmVudER1cmF0aW9uXCJdID0gMjAyXSA9IFwiTWVkaWFQbGF5ZXJFeHBlY3RpbmdEaWZmZXJlbnREdXJhdGlvblwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJNZWRpYVBsYXllckV4cGVjdGluZ0RpZmZlcmVudFNpemVcIl0gPSAyMDNdID0gXCJNZWRpYVBsYXllckV4cGVjdGluZ0RpZmZlcmVudFNpemVcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiQWRDYXRlZ29yeU5vdFByb3ZpZGVkXCJdID0gMjA0XSA9IFwiQWRDYXRlZ29yeU5vdFByb3ZpZGVkXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIklubGluZUNhdGVnb3J5VmlvbGF0ZXNXcmFwcGVyQmxvY2tlZEFkQ2F0ZWdvcmllc1wiXSA9IDIwNV0gPSBcIklubGluZUNhdGVnb3J5VmlvbGF0ZXNXcmFwcGVyQmxvY2tlZEFkQ2F0ZWdvcmllc1wiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJBZE5vdFNlcnZlZFwiXSA9IDIwNl0gPSBcIkFkTm90U2VydmVkXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIkdlbmVyYWxXcmFwcGVyRXJyb3JcIl0gPSAzMDBdID0gXCJHZW5lcmFsV3JhcHBlckVycm9yXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIlZBU1RVUklVbmF2YWlsYWJsZU9yVGltZW91dFwiXSA9IDMwMV0gPSBcIlZBU1RVUklVbmF2YWlsYWJsZU9yVGltZW91dFwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJXcmFwcGVyTGltaXRSZWFjaGVkXCJdID0gMzAyXSA9IFwiV3JhcHBlckxpbWl0UmVhY2hlZFwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJOb1ZBU1RSZXNwb25zZUFmdGVyV3JhcHBlclwiXSA9IDMwM10gPSBcIk5vVkFTVFJlc3BvbnNlQWZ0ZXJXcmFwcGVyXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIkFkVW5pdE5vdERpc3BsYXllZFwiXSA9IDMwNF0gPSBcIkFkVW5pdE5vdERpc3BsYXllZFwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJHZW5lcmFsTGluZWFyRXJyb3JcIl0gPSA0MDBdID0gXCJHZW5lcmFsTGluZWFyRXJyb3JcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiRmlsZU5vdEZvdW5kXCJdID0gNDAxXSA9IFwiRmlsZU5vdEZvdW5kXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIk1lZGlhRmlsZVVSSVRpbWVvdXRcIl0gPSA0MDJdID0gXCJNZWRpYUZpbGVVUklUaW1lb3V0XCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIlN1cHBvcnRlZE1lZGlhRmlsZU5vdEZvdW5kXCJdID0gNDAzXSA9IFwiU3VwcG9ydGVkTWVkaWFGaWxlTm90Rm91bmRcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiUHJvYmxlbURpc3BsYXlpbmdNZWRpYUZpbGVcIl0gPSA0MDVdID0gXCJQcm9ibGVtRGlzcGxheWluZ01lZGlhRmlsZVwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJNZXp6YW5pbmVOb3RQcm92aWRlZFwiXSA9IDQwNl0gPSBcIk1lenphbmluZU5vdFByb3ZpZGVkXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIk1lenphbmluZURvd25sb2FkaW5nXCJdID0gNDA3XSA9IFwiTWV6emFuaW5lRG93bmxvYWRpbmdcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiQ29uZGl0aW9uYWxBZFJlamVjdGVkXCJdID0gNDA4XSA9IFwiQ29uZGl0aW9uYWxBZFJlamVjdGVkXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIkludGVyYWN0aXZlVW5pdE5vdEV4ZWN1dGVkXCJdID0gNDA5XSA9IFwiSW50ZXJhY3RpdmVVbml0Tm90RXhlY3V0ZWRcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiVmVyaWZpY2F0aW9uVW5pdE5vdEV4ZWN1dGVkXCJdID0gNDEwXSA9IFwiVmVyaWZpY2F0aW9uVW5pdE5vdEV4ZWN1dGVkXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIk5vdFJlcXVpcmVkU3BlY2lmaWNhdGlvbk9mTWV6emFuaW5lXCJdID0gNDExXSA9IFwiTm90UmVxdWlyZWRTcGVjaWZpY2F0aW9uT2ZNZXp6YW5pbmVcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiR2VuZXJhbE5vbkxpbmVhckFkc0Vycm9yXCJdID0gNTAwXSA9IFwiR2VuZXJhbE5vbkxpbmVhckFkc0Vycm9yXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIk5vbkxpbmVhckFkTm9uRGlzcGxheWFibGVcIl0gPSA1MDFdID0gXCJOb25MaW5lYXJBZE5vbkRpc3BsYXlhYmxlXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIlVuYWJsZVRvRmV0Y2hOb25MaW5lYXJSZXNvdXJjZVwiXSA9IDUwMl0gPSBcIlVuYWJsZVRvRmV0Y2hOb25MaW5lYXJSZXNvdXJjZVwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJTdXBwb3J0ZWROb25MaW5lYXJSZXNvdXJjZU5vdEZvdW5kXCJdID0gNTAzXSA9IFwiU3VwcG9ydGVkTm9uTGluZWFyUmVzb3VyY2VOb3RGb3VuZFwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJHZW5lcmFsQ29tcGFuaW9uQWRzRXJyb3JcIl0gPSA2MDBdID0gXCJHZW5lcmFsQ29tcGFuaW9uQWRzRXJyb3JcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiQ29tcGFuaW9uTm9uRGlzcGxheWFibGVCeURpbWVtc2lvbkVycm9yXCJdID0gNjAxXSA9IFwiQ29tcGFuaW9uTm9uRGlzcGxheWFibGVCeURpbWVtc2lvbkVycm9yXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIlJlcXVpcmVkQ29tcGFuaW9uTm9uRGlzcGxheWFibGVcIl0gPSA2MDJdID0gXCJSZXF1aXJlZENvbXBhbmlvbk5vbkRpc3BsYXlhYmxlXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIlVuYWJsZVRvRmV0Y2hOb25Db21wYW5pb25SZXNvdXJjZVwiXSA9IDYwM10gPSBcIlVuYWJsZVRvRmV0Y2hOb25Db21wYW5pb25SZXNvdXJjZVwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJTdXBwb3J0ZWRDb21wYW5pb25SZXNvdXJjZU5vdEZvdW5kXCJdID0gNjA0XSA9IFwiU3VwcG9ydGVkQ29tcGFuaW9uUmVzb3VyY2VOb3RGb3VuZFwiO1xuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJVbmRlZmluZWRFcnJvclwiXSA9IDkwMF0gPSBcIlVuZGVmaW5lZEVycm9yXCI7XG4gICAgRXJyb3JDb2RlW0Vycm9yQ29kZVtcIkdlbmVyYWxWUEFJREVycm9yXCJdID0gOTAxXSA9IFwiR2VuZXJhbFZQQUlERXJyb3JcIjtcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiR2VuZXJhbEludGVyYWN0aXZlQ3JlYXRpdmVGaWxlRXJyb3JcIl0gPSA5MDJdID0gXCJHZW5lcmFsSW50ZXJhY3RpdmVDcmVhdGl2ZUZpbGVFcnJvclwiO1xufSkoRXJyb3JDb2RlIHx8IChFcnJvckNvZGUgPSB7fSkpO1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlcGxhY2VyKHZpZGVvUGFyZW50KSB7XG4gICAgbGV0IHJlcGxhY2VNYXAgPSBuZXcgTWFwKCk7XG4gICAgLy8gdGltZSBzdGFtcFxuICAgIHJlcGxhY2VNYXAuc2V0KFwiW1RJTUVTVEFNUF1cIiwgZ2V0VGltZXN0YW1wKCkpO1xuICAgIC8vIGludmlldyByYXRpb1xuICAgIGNvbnN0IGludmlld1JhdGlvTWdyID0ge1xuICAgICAgICByYXRpbzogMFxuICAgIH07XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgcm9vdE1hcmdpbjogXCIwcHhcIixcbiAgICAgICAgdGhyZXNob2xkOiBbMCwgMC4xLCAwLjIsIDAuMywgMC40LCAwLjUsIDAuNiwgMC43LCAwLjgsIDAuOSwgMV1cbiAgICB9O1xuICAgIGZ1bmN0aW9uIGNhbGxiYWNrKGVudHJpZXMpIHtcbiAgICAgICAgZW50cmllcy5mb3JFYWNoKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBNYXRoLmZsb29yKGVudHJ5LmludGVyc2VjdGlvblJhdGlvICogMTAwKSAvIDEwMDtcbiAgICAgICAgICAgIGludmlld1JhdGlvTWdyLnJhdGlvID0gcmF0aW87XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWRlb1BhcmVudCk7XG4gICAgcmVwbGFjZU1hcC5zZXQoXCJbSU5WSUVXX1JBVElPXVwiLCBnZXRJbnZpZXdSYXRpbyhpbnZpZXdSYXRpb01ncikpO1xuICAgIHJldHVybiAodGFyZ2V0LCBlcnJvckNvZGUpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJSRVBMQUNFIE1BUDpcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcGxhY2VNYXApO1xuICAgICAgICBpZiAoZXJyb3JDb2RlKSB7XG4gICAgICAgICAgICByZXBsYWNlTWFwLnNldChcIltFUlJPUkNPREVdXCIsIGVycm9yQ29kZS50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICByZXBsYWNlTWFwLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUkVQTEFDRVIgS0VZOiBcIiArIGtleSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJFUExBQ0VSIFZBTFVFOiBcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucmVwbGFjZShrZXksIHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiID8gdmFsdWUoKSA6IHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldFRpbWVzdGFtcCgpIHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCk7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldEludmlld1JhdGlvKGludmlld1JhdGlvTWdyKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGludmlld1JhdGlvTWdyLnJhdGlvLnRvRml4ZWQoMik7XG4gICAgfTtcbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0VGltZVRvU2Vjb25kKGR1cmF0aW9uU3RyKSB7XG4gICAgbGV0IHJlc3VsdCA9IGR1cmF0aW9uU3RyLm1hdGNoKC8oXFxkezJ9KTooXFxkezJ9KTooXFxkezJ9KS8pO1xuICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPCA0IHx8IHBhcnNlSW50KHJlc3VsdFsxXSkgPT09IE5hTiB8fCBwYXJzZUludChyZXN1bHRbMl0pID09PSBOYU4gfHwgcGFyc2VJbnQocmVzdWx0WzNdKSA9PT0gTmFOKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImNvbnZlcnRkdXJhdGlvblRvU2Vjb25kIGVycm9yOiBcIiArIGR1cmF0aW9uU3RyKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnNlSW50KHJlc3VsdFsxXSkgKiA2MCAqIDYwICsgcGFyc2VJbnQocmVzdWx0WzJdKSAqIDYwICsgcGFyc2VGbG9hdChyZXN1bHRbM10pO1xufVxuIiwiaW1wb3J0IHsgc2VuZEVycm9yIH0gZnJvbSBcIi4vYmVhY29uXCI7XG5pbXBvcnQgeyBFcnJvckNvZGUgfSBmcm9tIFwiLi4vLi4vdXRpbC9tYWNyb1wiO1xuaW1wb3J0IHsgY29udmVydFRpbWVUb1NlY29uZCB9IGZyb20gXCIuLi8uLi91dGlsL3RpbWVcIjtcbmNvbnN0IFdSQVBQRVJfTUFYID0gNTtcbmNvbnN0IFRSQUNLSU5HX0VWRU5UX1BPSU5UID0gbmV3IE1hcChbXG4gICAgW1wic3RhcnRcIiwgMF0sXG4gICAgW1wiZmlyc3RRdWFydGlsZVwiLCAxIC8gNF0sXG4gICAgW1wibWlkcG9pbnRcIiwgMSAvIDJdLFxuICAgIFtcInRoaXJkUXVhcnRpbGVcIiwgMyAvIDRdLFxuICAgIFtcImNvbXBsZXRlXCIsIDFdXG5dKTtcbmNsYXNzIFZhc3Qge1xuICAgIGVycm9yVXJscztcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5lcnJvclVybHMgPSBbXTtcbiAgICB9XG4gICAgaXNXcmFwcGVyKHZFbGUpIHtcbiAgICAgICAgY29uc3Qgd3JhcHBlckVsZSA9IHZFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5BZD5XcmFwcGVyXCIpO1xuICAgICAgICBpZiAod3JhcHBlckVsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBhc3luYyBuZXh0VmFzdCh2RWxlKSB7XG4gICAgICAgIGNvbnN0IHZhc3RBZFRhZ1VSSUVsZSA9IHZFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5BZD5XcmFwcGVyPlZBU1RBZFRhZ1VSSVwiKTtcbiAgICAgICAgaWYgKCF2YXN0QWRUYWdVUklFbGUgfHwgIXZhc3RBZFRhZ1VSSUVsZS50ZXh0Q29udGVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibmV4dCB2YXN0IHVybCBlcnJvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdXJsID0gdmFzdEFkVGFnVVJJRWxlLnRleHRDb250ZW50O1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLnRleHQoKTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIGFzeW5jIHBhcnNlVmFzdChzb3VyY2VWYXN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgdmFzdEVsZSA9IHRoaXMucGFyc2VWYXN0WE1MKHNvdXJjZVZhc3QpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gV1JBUFBFUl9NQVg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzV3JhcHBlcih2YXN0RWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSBXUkFQUEVSX01BWCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidG9vIG1hbnkgd3JhcHBlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VWYXN0ID0gYXdhaXQgdGhpcy5uZXh0VmFzdCh2YXN0RWxlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFzdEVsZSA9IHRoaXMucGFyc2VWYXN0WE1MKHNvdXJjZVZhc3QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHZhc3RPYmplY3QgPSB0aGlzLmNyZWF0ZVZhc3RPYmplY3QodmFzdEVsZSk7XG4gICAgICAgICAgICByZXR1cm4gdmFzdE9iamVjdDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbRVJST1JdIGNhbm5vdCBjcmVhdGUgVkFTVE9iamVjdDogXCIgKyBlKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHBhcnNlVmFzdFhNTChzb3VyY2VWYXN0KSB7XG4gICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgbGV0IHhtbERvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoc291cmNlVmFzdCwgXCJhcHBsaWNhdGlvbi94bWxcIik7XG4gICAgICAgIGxldCBwYXJzZXJFcnJvciA9IHhtbERvYy5xdWVyeVNlbGVjdG9yKFwicGFyc2VyZXJyb3JcIik7XG4gICAgICAgIGlmIChwYXJzZXJFcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHBhcnNlckVycm9yLnRleHRDb250ZW50IHx8IFwicGFyc2UgdmFzdCBlcnJvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdmFzdEVsZSA9IHhtbERvYy5xdWVyeVNlbGVjdG9yKFwiVkFTVFwiKTtcbiAgICAgICAgaWYgKCF2YXN0RWxlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWQVNUIHRhZyBub3QgZm91bmRcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhc3RFbGU7XG4gICAgfVxuICAgIGNyZWF0ZVZhc3RPYmplY3QodkVsZSkge1xuICAgICAgICBjb25zdCByb290RXJyb3JFbGUgPSB2RWxlLnF1ZXJ5U2VsZWN0b3IoXCI6c2NvcGU+RXJyb3JcIik7XG4gICAgICAgIGlmIChyb290RXJyb3JFbGUgJiYgcm9vdEVycm9yRWxlLnRleHRDb250ZW50KVxuICAgICAgICAgICAgdGhpcy5lcnJvclVybHMucHVzaChyb290RXJyb3JFbGUudGV4dENvbnRlbnQpO1xuICAgICAgICBjb25zdCBpbmxpbmVFbGUgPSB2RWxlLnF1ZXJ5U2VsZWN0b3IoXCI6c2NvcGU+QWQ+SW5MaW5lXCIpO1xuICAgICAgICBpZiAoIWlubGluZUVsZSkge1xuICAgICAgICAgICAgc2VuZEVycm9yKHRoaXMuZXJyb3JVcmxzLCBFcnJvckNvZGUuTm9WQVNUUmVzcG9uc2VBZnRlcldyYXBwZXIpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicGFyc2UgSW5MaW5lIGVycm9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVycm9yRWxlID0gaW5saW5lRWxlLnF1ZXJ5U2VsZWN0b3IoXCI6c2NvcGU+RXJyb3JcIik7XG4gICAgICAgIGlmIChlcnJvckVsZSAmJiBlcnJvckVsZS50ZXh0Q29udGVudClcbiAgICAgICAgICAgIHRoaXMuZXJyb3JVcmxzLnB1c2goZXJyb3JFbGUudGV4dENvbnRlbnQpO1xuICAgICAgICBjb25zdCBpbXBFbGUgPSBpbmxpbmVFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5JbXByZXNzaW9uXCIpO1xuICAgICAgICBpZiAoIWltcEVsZSB8fCAhaW1wRWxlLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICBzZW5kRXJyb3IodGhpcy5lcnJvclVybHMsIEVycm9yQ29kZS5YTUxQYXJzZUVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInBhcnNlIEluTGluZSBJbXByZXNzaW9uIGVycm9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGltcHJlc3Npb25VcmwgPSBpbXBFbGUudGV4dENvbnRlbnQ7XG4gICAgICAgIGNvbnN0IGFkVGl0bGVFbGUgPSBpbmxpbmVFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5BZFRpdGxlXCIpO1xuICAgICAgICBpZiAoIWFkVGl0bGVFbGUgfHwgIWFkVGl0bGVFbGUudGV4dENvbnRlbnQpIHtcbiAgICAgICAgICAgIHNlbmRFcnJvcih0aGlzLmVycm9yVXJscywgRXJyb3JDb2RlLlhNTFBhcnNlRXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicGFyc2UgSW5MaW5lIEFkVGl0bGUgZXJyb3JcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWRUaXRsZSA9IGFkVGl0bGVFbGUudGV4dENvbnRlbnQ7XG4gICAgICAgIGxldCBhZERlc2MgPSBudWxsO1xuICAgICAgICBjb25zdCBhZERlc2NFbGUgPSBpbmxpbmVFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5EZXNjcmlwdGlvblwiKTtcbiAgICAgICAgaWYgKGFkRGVzY0VsZSAmJiBhZERlc2NFbGUudGV4dENvbnRlbnQpIHtcbiAgICAgICAgICAgIGFkRGVzYyA9IGFkRGVzY0VsZS50ZXh0Q29udGVudDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsaW5lYXJFbGUgPSBpbmxpbmVFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5DcmVhdGl2ZXM+Q3JlYXRpdmU+TGluZWFyXCIpO1xuICAgICAgICBpZiAoIWxpbmVhckVsZSkge1xuICAgICAgICAgICAgc2VuZEVycm9yKHRoaXMuZXJyb3JVcmxzLCBFcnJvckNvZGUuWE1MUGFyc2VFcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJwYXJzZSBJbkxpbmUgTGluZWFyIGVycm9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uRWxlID0gbGluZWFyRWxlLnF1ZXJ5U2VsZWN0b3IoXCI6c2NvcGU+RHVyYXRpb25cIik7XG4gICAgICAgIGlmICghZHVyYXRpb25FbGUgfHwgIWR1cmF0aW9uRWxlLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICBzZW5kRXJyb3IodGhpcy5lcnJvclVybHMsIEVycm9yQ29kZS5YTUxQYXJzZUVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInBhcnNlIEluTGluZSBMaW5lYXIgRHVyYXRpb24gZXJyb3JcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBjb252ZXJ0VGltZVRvU2Vjb25kKGR1cmF0aW9uRWxlLnRleHRDb250ZW50KTtcbiAgICAgICAgY29uc3QgdHJhY2tpbmdzRWxlcyA9IGxpbmVhckVsZS5xdWVyeVNlbGVjdG9yQWxsKFwiOnNjb3BlPlRyYWNraW5nRXZlbnRzPlRyYWNraW5nXCIpO1xuICAgICAgICBjb25zdCB0cmFja2luZ01hcCA9IHRoaXMuY3JlYXRlVHJhY2tpbmdPYmplY3QodHJhY2tpbmdzRWxlcywgZHVyYXRpb24pO1xuICAgICAgICBjb25zdCBpY29uRWxlcyA9IGxpbmVhckVsZS5xdWVyeVNlbGVjdG9yQWxsKFwiOnNjb3BlPkljb25zPkljb25cIik7XG4gICAgICAgIGNvbnN0IGljb25PYmplY3RzID0gdGhpcy5jcmVhdGVJY29uT2JqZWN0KGljb25FbGVzKTtcbiAgICAgICAgY29uc3QgbWVkaWFGaWxlRWxlcyA9IGxpbmVhckVsZS5xdWVyeVNlbGVjdG9yQWxsKFwiOnNjb3BlPk1lZGlhRmlsZXM+TWVkaWFGaWxlXCIpO1xuICAgICAgICBpZiAoIW1lZGlhRmlsZUVsZXMpIHtcbiAgICAgICAgICAgIHNlbmRFcnJvcih0aGlzLmVycm9yVXJscywgRXJyb3JDb2RlLlhNTFBhcnNlRXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicGFyc2UgTWVkaWFGaWxlcyBlcnJvclwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyDjgbLjgajjgb7jgZox44Gk55uu44GuTWVkaWFGaWxl44GuVVJM44Gu44G/5Y+W5b6XXG4gICAgICAgIGNvbnN0IG1lZGlhRmlsZVVybCA9IG1lZGlhRmlsZUVsZXNbMF0/LnRleHRDb250ZW50O1xuICAgICAgICBjb25zdCB2aWRlb0NsaWNrc0VsZSA9IGxpbmVhckVsZS5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPlZpZGVvQ2xpY2tzXCIpO1xuICAgICAgICBsZXQgY2xpY2tUaHJvdWdoVXJsID0gbnVsbDtcbiAgICAgICAgbGV0IGNsaWNrVHJhY2tpbmdVcmxzID0gW107XG4gICAgICAgIGlmICh2aWRlb0NsaWNrc0VsZSkge1xuICAgICAgICAgICAgY29uc3QgY2xpY2tUaHJvdWdoRWxlID0gdmlkZW9DbGlja3NFbGUucXVlcnlTZWxlY3RvcihcIjpzY29wZT5DbGlja1Rocm91Z2hcIik7XG4gICAgICAgICAgICBpZiAoIWNsaWNrVGhyb3VnaEVsZSB8fCAhY2xpY2tUaHJvdWdoRWxlLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICAgICAgc2VuZEVycm9yKHRoaXMuZXJyb3JVcmxzLCBFcnJvckNvZGUuWE1MUGFyc2VFcnJvcik7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicGFyc2UgSW5MaW5lIExpbmVhciBDbGlja1Rocm91Z2ggZXJyb3JcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGlja1Rocm91Z2hVcmwgPSBjbGlja1Rocm91Z2hFbGUudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICBjb25zdCBjbGlja1RyYWNraW5nRWxlcyA9IHZpZGVvQ2xpY2tzRWxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6c2NvcGU+Q2xpY2tUcmFja2luZ1wiKTtcbiAgICAgICAgICAgIGZvciAobGV0IGNsaWNrVHJhY2tpbmdFbGUgb2YgY2xpY2tUcmFja2luZ0VsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2xpY2tUcmFja2luZ0VsZS50ZXh0Q29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICBjbGlja1RyYWNraW5nVXJscy5wdXNoKGNsaWNrVHJhY2tpbmdFbGUudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YXN0T2JqZWN0ID0ge1xuICAgICAgICAgICAgZXJyb3JVcmxzOiB0aGlzLmVycm9yVXJscyxcbiAgICAgICAgICAgIGltcHJlc3Npb25VcmxzOiBbaW1wcmVzc2lvblVybF0sXG4gICAgICAgICAgICBhZFRpdGxlOiBhZFRpdGxlLFxuICAgICAgICAgICAgYWREZXNjOiBhZERlc2MsXG4gICAgICAgICAgICB0cmFja2luZ3M6IHRyYWNraW5nTWFwLFxuICAgICAgICAgICAgaWNvbnM6IGljb25PYmplY3RzLFxuICAgICAgICAgICAgbWVkaWFGaWxlVXJsOiBtZWRpYUZpbGVVcmwsXG4gICAgICAgICAgICBjbGlja1Rocm91Z2hVcmw6IGNsaWNrVGhyb3VnaFVybCxcbiAgICAgICAgICAgIGNsaWNrVHJhY2tpbmdVcmxzOiBjbGlja1RyYWNraW5nVXJscyxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHZhc3RPYmplY3Q7XG4gICAgfVxuICAgIGNyZWF0ZVRyYWNraW5nT2JqZWN0KHRyYWNraW5nRWxlcywgZHVyYXRpb24pIHtcbiAgICAgICAgY29uc3QgdHJhY2tpbmdNYXAgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRyYWNraW5nRWxlcy5mb3JFYWNoKGZ1bmN0aW9uICh0cmFja2luZykge1xuICAgICAgICAgICAgaWYgKCF0cmFja2luZy50ZXh0Q29udGVudClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IHRyYWNraW5nLmdldEF0dHJpYnV0ZShcImV2ZW50XCIpO1xuICAgICAgICAgICAgaWYgKCFldmVudClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBpZiAoZXZlbnQgPT09IFwicHJvZ3Jlc3NcIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHRyYWNraW5nLmdldEF0dHJpYnV0ZShcIm9mZnNldFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIW9mZnNldClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFNlY29uZCA9IGNvbnZlcnRUaW1lVG9TZWNvbmQob2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB0cmFja2luZ01hcC5zZXQob2Zmc2V0U2Vjb25kLCB0cmFja2luZy50ZXh0Q29udGVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudF9wb2ludCA9IFRSQUNLSU5HX0VWRU5UX1BPSU5ULmdldChldmVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50X3BvaW50ICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0cmFja2luZ01hcC5zZXQoZXZlbnRfcG9pbnQgKiBkdXJhdGlvbiwgdHJhY2tpbmcudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tpbmdNYXAuc2V0KGV2ZW50LCB0cmFja2luZy50ZXh0Q29udGVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRyYWNraW5nTWFwO1xuICAgIH1cbiAgICBjcmVhdGVJY29uT2JqZWN0KGljb25FbGVzKSB7XG4gICAgICAgIGxldCBpY29uT2JqZWN0cyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpY29uIG9mIGljb25FbGVzKSB7XG4gICAgICAgICAgICBsZXQgaWNvbkVsZSA9IGljb247XG4gICAgICAgICAgICBsZXQgd2lkdGggPSBwYXJzZUludChpY29uRWxlLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpIHx8IFwiMTBcIikgfHwgMTA7XG4gICAgICAgICAgICBsZXQgaGVpZ2h0ID0gcGFyc2VJbnQoaWNvbkVsZS5nZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIikgfHwgXCIxMFwiKSB8fCAxMDtcbiAgICAgICAgICAgIGxldCB4ID0gXCIwcHhcIjtcbiAgICAgICAgICAgIGxldCB4UG9zaXRpb24gPSBpY29uRWxlLmdldEF0dHJpYnV0ZShcInhQb3NpdGlvblwiKTtcbiAgICAgICAgICAgIGlmICh4UG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoeFBvc2l0aW9uID09PSBcImxlZnRcIiB8fCB4UG9zaXRpb24gPT09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICB4ID0geFBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgeCA9IHhQb3NpdGlvbiArIFwicHhcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgeSA9IFwiMHB4XCI7XG4gICAgICAgICAgICBsZXQgeVBvc2l0aW9uID0gaWNvbkVsZS5nZXRBdHRyaWJ1dGUoXCJ5UG9zaXRpb25cIik7XG4gICAgICAgICAgICBpZiAoeVBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHlQb3NpdGlvbiA9PT0gXCJ0b3BcIiB8fCB5UG9zaXRpb24gPT09IFwiYm90dG9tXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgeSA9IHlQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHkgPSB5UG9zaXRpb24gKyBcInB4XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG9mZnNldCA9IGljb25FbGUuZ2V0QXR0cmlidXRlKFwib2Zmc2V0XCIpO1xuICAgICAgICAgICAgbGV0IHN0YXJ0ID0gMDtcbiAgICAgICAgICAgIGlmIChvZmZzZXQpXG4gICAgICAgICAgICAgICAgc3RhcnQgPSBjb252ZXJ0VGltZVRvU2Vjb25kKG9mZnNldCk7XG4gICAgICAgICAgICBsZXQgZHVyYXRpb24gPSBpY29uRWxlLmdldEF0dHJpYnV0ZShcImR1cmF0aW9uXCIpO1xuICAgICAgICAgICAgbGV0IGVuZCA9IG51bGw7XG4gICAgICAgICAgICBpZiAoZHVyYXRpb24pXG4gICAgICAgICAgICAgICAgZW5kID0gY29udmVydFRpbWVUb1NlY29uZChkdXJhdGlvbikgKyBzdGFydDtcbiAgICAgICAgICAgIGNvbnN0IHN0YXRpY1Jlc291cmNlID0gaWNvbkVsZS5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPlN0YXRpY1Jlc291cmNlXCIpO1xuICAgICAgICAgICAgaWYgKCFzdGF0aWNSZXNvdXJjZSB8fCAhc3RhdGljUmVzb3VyY2UudGV4dENvbnRlbnQpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBjb25zdCBpY29uQ2xpY2tUaHJvdWdoID0gaWNvbkVsZS5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPkljb25DbGlja3M+SWNvbkNsaWNrVGhyb3VnaFwiKTtcbiAgICAgICAgICAgIGNvbnN0IGljb25DbGlja1RyYWNraW5nID0gaWNvbkVsZS5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPkljb25DbGlja3M+SWNvbkNsaWNrVHJhY2tpbmdcIik7XG4gICAgICAgICAgICBpY29uT2JqZWN0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICAgICAgeFBvc2l0aW9uOiB4LFxuICAgICAgICAgICAgICAgIHlQb3NpdGlvbjogeSxcbiAgICAgICAgICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgICAgICAgICAgZW5kOiBlbmQsXG4gICAgICAgICAgICAgICAgaW1nVXJsOiBzdGF0aWNSZXNvdXJjZS50ZXh0Q29udGVudCxcbiAgICAgICAgICAgICAgICBjbGlja1Rocm91Z2hVcmw6IGljb25DbGlja1Rocm91Z2g/LnRleHRDb250ZW50ID8/IG51bGwsXG4gICAgICAgICAgICAgICAgY2xpY2tUcmFja2luZ1VybDogaWNvbkNsaWNrVHJhY2tpbmc/LnRleHRDb250ZW50ID8/IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpY29uT2JqZWN0cztcbiAgICB9XG59XG5leHBvcnQgY29uc3QgdmFzdCA9IG5ldyBWYXN0KCk7XG4iLCJpbXBvcnQgKiBhcyBsaWIgZnJvbSBcIi4uL2xpYi9pbmRleFwiO1xuY29uc3QgY29udGFpbmVyID0gYFxuPCFET0NUWVBFIGh0bWw+XG48aHRtbD5cbiAgICA8aGVhZD5cbiAgICA8L2hlYWQ+XG4gICAgPGJvZHkgc3R5bGU9XCJtYXJnaW46MDtcIj5cbiAgICAgICAgPGRpdiBpZD1cInZhc3RfdmlkZW9fY29udGFpbmVyXCI+XG4gICAgICAgICAgICA8ZGl2IGlkPVwidmFzdF92aWRlb1wiIHN0eWxlPVwid2lkdGg6MzAwcHg7aGVpZ2h0OjE2OC43NXB4O1wiPjwvZGl2PlxuICAgICAgICAgICAgPGRpdiBpZD1cInByb2dyZXNzX2JhclwiIHN0eWxlPVwid2lkdGg6NTAlO2hlaWdodDozcHg7YmFja2dyb3VuZC1jb2xvcjpncmF5O1wiPjwvZGl2PlxuICAgICAgICAgICAgPGRpdiBpZD1cImFkX3RleHRcIiBzdHlsZT1cIm1hcmdpbjowO3dpZHRoOjMwMHB4O2hlaWdodDo3OC4yNXB4O2JhY2tncm91bmQtY29sb3I6I2RjZGNkYztcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGlkPVwiYWRfdGl0bGVcIiBzdHlsZT1cImZvbnQtc2l6ZToxNXB4O2ZvbnQtd2VpZ2h0OmJvbGQ7XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBpZD1cImFkX2Rlc2NcIiBzdHlsZT1cImZvbnQtc2l6ZToxMHB4O1wiPjwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvYm9keT5cbjwvaHRtbD5cbmA7XG5jb25zdCBpbmxpbmVWYXN0U2FtcGxlID0gYFxuPFZBU1QgdmVyc2lvbj1cIjQuMlwiPlxuICA8RXJyb3I+XG4gICAgPCFbQ0RBVEFbaHR0cDovL3Rlc3QuZXhhbXBsZS9lcnJvcj9jb2RlPVtFUlJPUkNPREVdJmNsaWVudFRpbWU9W1RJTUVTVEFNUF1dXT5cbiAgPC9FcnJvcj5cbiAgPEFkIGlkPVwiMWIzMzBlNTktM2E2Mi00MDAwLWI5ZmItYWM5NzI2ZTk4YzUyXCIgc2VxdWVuY2U9XCIxXCI+XG4gICAgPFdyYXBwZXI+XG4gICAgICA8VkFTVEFkVGFnVVJJPlxuICAgICAgICA8IVtDREFUQVtodHRwOi8vbG9jYWxob3N0OjgwODAvc2FtcGxlL2lubGluZS5odG1sXV0+XG4gICAgICA8L1ZBU1RBZFRhZ1VSST5cbiAgICA8L1dyYXBwZXI+XG4gIDwvQWQ+XG48L1ZBU1Q+XG5gO1xuY2xhc3MgVmFzdEV4ZWN1dG9yIHtcbiAgICBhc3luYyBzdGFydFBsYXllcihzb3VyY2VWYXN0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic2V0UGxheWVyIHN0YXJ0ZWQuLi5cIik7XG4gICAgICAgIHNvdXJjZVZhc3QgPSBpbmxpbmVWYXN0U2FtcGxlO1xuICAgICAgICBjb25zdCB2YXN0T2JqZWN0ID0gYXdhaXQgbGliLnZhc3QucGFyc2VWYXN0KHNvdXJjZVZhc3QpO1xuICAgICAgICBpZiAoIXZhc3RPYmplY3QpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcbiAgICAgICAgaWZyYW1lLndpZHRoID0gXCIzMDBweFwiO1xuICAgICAgICBpZnJhbWUuaGVpZ2h0ID0gXCIyNTBweFwiO1xuICAgICAgICBpZnJhbWUuc3R5bGUuYm9yZGVyID0gXCJub25lXCI7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyYm94XCIpPy5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICBsZXQgaURvYyA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50O1xuICAgICAgICBpRG9jLm9wZW4oKTtcbiAgICAgICAgaURvYy53cml0ZShjb250YWluZXIpO1xuICAgICAgICBpRG9jLmNsb3NlKCk7XG4gICAgICAgIGlEb2MuZG9jdW1lbnRFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICAgICAgbGV0IGFkVGl0bGVEaXYgPSBpRG9jLmdldEVsZW1lbnRCeUlkKFwiYWRfdGl0bGVcIik7XG4gICAgICAgIGFkVGl0bGVEaXYudGV4dENvbnRlbnQgPSB2YXN0T2JqZWN0LmFkVGl0bGU7XG4gICAgICAgIGxldCBhZERlc2NEaXYgPSBpRG9jLmdldEVsZW1lbnRCeUlkKFwiYWRfZGVzY1wiKTtcbiAgICAgICAgaWYgKHZhc3RPYmplY3QuYWREZXNjKSB7XG4gICAgICAgICAgICBhZERlc2NEaXYudGV4dENvbnRlbnQgPSB2YXN0T2JqZWN0LmFkRGVzYztcbiAgICAgICAgfVxuICAgICAgICBsZXQgdmFzdFZpZGVvRGl2ID0gaURvYy5nZXRFbGVtZW50QnlJZChcInZhc3RfdmlkZW9cIik7XG4gICAgICAgIGxldCB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ2aWRlb1wiKTtcbiAgICAgICAgdmlkZW8uc3JjID0gdmFzdE9iamVjdC5tZWRpYUZpbGVVcmw7XG4gICAgICAgIHZpZGVvLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgICAgIHZpZGVvLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuICAgICAgICB2aWRlby5tdXRlZCA9IHRydWU7XG4gICAgICAgIHZpZGVvLmF1dG9wbGF5ID0gdHJ1ZTtcbiAgICAgICAgLy8gbG9hZGVkbWV0YWRhdGHjgqTjg5njg7Pjg4jlvozjgafjgarjgYTjgahkdXJhdGlvbuOBjOWPluOCjOOBquOBhFxuICAgICAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkbWV0YWRhdGFcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGxldCBwcm9ncmVzc2JhciA9IGlEb2MuZ2V0RWxlbWVudEJ5SWQoXCJwcm9ncmVzc19iYXJcIik7XG4gICAgICAgICAgICBsZXQgYmFyQW5pbWF0aW9uTG9vcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBsZXQgcHJvZ3Jlc3NQb2ludCA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gdmlkZW8uZHVyYXRpb24gKiAxMDA7XG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3NiYXIuc3R5bGUud2lkdGggPSBwcm9ncmVzc1BvaW50ICsgXCIlXCI7XG4gICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGJhckFuaW1hdGlvbkxvb3ApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShiYXJBbmltYXRpb25Mb29wKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG1hY3JvUmVwbGFjZXIgPSBsaWIuY3JlYXRlUmVwbGFjZXIodmFzdFZpZGVvRGl2KTtcbiAgICAgICAgbGliLnNldEJlYWNvbnModmlkZW8sIHZhc3RPYmplY3QsIG1hY3JvUmVwbGFjZXIpO1xuICAgICAgICBsaWIuc2V0SWNvbnModmlkZW8sIHZhc3RWaWRlb0RpdiwgdmFzdE9iamVjdCwgbWFjcm9SZXBsYWNlcik7XG4gICAgICAgIC8vIEludGVyc2VjdGlvbk9ic2VydmVyXG4gICAgICAgIC8vIDUwJeeUu+mdouWGheOBq+WFpeOBo+OBn+OCieWGjeeUn+OAgeWHuuOBn+OCieWBnOatolxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgcm9vdE1hcmdpbjogXCIwcHhcIixcbiAgICAgICAgICAgIHRocmVzaG9sZDogMC41XG4gICAgICAgIH07XG4gICAgICAgIGZ1bmN0aW9uIGNhbGxiYWNrKGVudHJpZXMpIHtcbiAgICAgICAgICAgIGVudHJpZXMuZm9yRWFjaChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgICAgICBpZiAoZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmlkZW8ucGF1c2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgICAgIG9ic2VydmVyLm9ic2VydmUodmlkZW8pO1xuICAgICAgICB2YXN0VmlkZW9EaXYuYXBwZW5kQ2hpbGQodmlkZW8pO1xuICAgIH1cbn1cbmNvbnN0IHZhc3RFeGVjdXRvciA9IG5ldyBWYXN0RXhlY3V0b3IoKTtcbndpbmRvdy52YXN0RXhlY3V0b3IgPSB3aW5kb3cudmFzdEV4ZWN1dG9yIHx8IHZhc3RFeGVjdXRvcjtcbiIsImltcG9ydCB7IGNyZWF0ZUJlYWNvbiB9IGZyb20gXCIuL2JlYWNvblwiO1xuZXhwb3J0IGZ1bmN0aW9uIHNldEljb25zKHZpZGVvLCBpY29uUGFyZW50LCB2YXN0T2JqZWN0LCBtYWNyb1JlcGxhY2VyKSB7XG4gICAgZm9yIChsZXQgaWNvbk9iaiBvZiB2YXN0T2JqZWN0Lmljb25zKSB7XG4gICAgICAgIGxldCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgICAgaWNvbi5zcmMgPSBpY29uT2JqLmltZ1VybDtcbiAgICAgICAgaWNvbi53aWR0aCA9IGljb25PYmoud2lkdGg7XG4gICAgICAgIGljb24uaGVpZ2h0ID0gaWNvbk9iai5oZWlnaHQ7XG4gICAgICAgIGljb24uc3R5bGUucG9zaXRpb24gPSBcImZpeGVkXCI7XG4gICAgICAgIGlmIChpY29uT2JqLnhQb3NpdGlvbiA9PT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgIGljb24uc3R5bGUubGVmdCA9IFwiMHB4XCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaWNvbk9iai54UG9zaXRpb24gPT09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgaWNvbi5zdHlsZS5yaWdodCA9IFwiMHB4XCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpY29uLnN0eWxlLmxlZnQgPSBpY29uT2JqLnhQb3NpdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaWNvbk9iai55UG9zaXRpb24gPT09IFwidG9wXCIpIHtcbiAgICAgICAgICAgIGljb24uc3R5bGUudG9wID0gXCIwcHhcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpY29uT2JqLnlQb3NpdGlvbiA9PT0gXCJib3R0b21cIikge1xuICAgICAgICAgICAgaWNvbi5zdHlsZS5ib3R0b20gPSBcIjBweFwiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWNvbi5zdHlsZS50b3AgPSBpY29uT2JqLnlQb3NpdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGljb25PYmouY2xpY2tUcmFja2luZ1VybCkge1xuICAgICAgICAgICAgICAgIGNyZWF0ZUJlYWNvbih2aWRlbywgaWNvbk9iai5jbGlja1RyYWNraW5nVXJsLCBtYWNyb1JlcGxhY2VyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpY29uT2JqLmNsaWNrVGhyb3VnaFVybCkge1xuICAgICAgICAgICAgICAgIG9wZW4oaWNvbk9iai5jbGlja1Rocm91Z2hVcmwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgZnVuY3Rpb24gdGltZUljb25FdmVudChlKSB7XG4gICAgICAgICAgICBpZiAoIWljb25QYXJlbnQuY29udGFpbnMoaWNvbikgJiYgdmlkZW8uY3VycmVudFRpbWUgPj0gaWNvbk9iai5zdGFydCkge1xuICAgICAgICAgICAgICAgIGljb25QYXJlbnQuYXBwZW5kQ2hpbGQoaWNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaWNvbk9iai5lbmQgJiYgaWNvblBhcmVudC5jb250YWlucyhpY29uKSAmJiB2aWRlby5jdXJyZW50VGltZSA+PSBpY29uT2JqLmVuZCkge1xuICAgICAgICAgICAgICAgIGljb25QYXJlbnQucmVtb3ZlQ2hpbGQoaWNvbik7XG4gICAgICAgICAgICAgICAgdmlkZW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgdGltZUljb25FdmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBlbmTmnKrlrprnvqnjga5pY29u44Gu5YmK6ZmkXG4gICAgICAgIGlmICghaWNvbk9iai5lbmQpIHtcbiAgICAgICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJlbmRlZFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChpY29uUGFyZW50LmNvbnRhaW5zKGljb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIGljb25QYXJlbnQucmVtb3ZlQ2hpbGQoaWNvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwibmFtZXMiOlsiY3JlYXRlQmVhY29uIiwicGFyZW50IiwidXJsIiwibWFjcm9SZXBsYWNlciIsIkRhdGUiLCJlbGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJzdHlsZSIsImRpc3BsYXkiLCJwcmVwZW5kIiwiY29uc29sZSIsImxvZyIsInNlbmRFcnJvciIsInVybHMiLCJlcnJvckNvZGUiLCJyZXBsYWNlIiwidG9TdHJpbmciLCJib2R5IiwiRXJyb3JDb2RlIiwiY29udmVydFRpbWVUb1NlY29uZCIsImR1cmF0aW9uU3RyIiwicmVzdWx0IiwibWF0Y2giLCJsZW5ndGgiLCJOYU4iLCJwYXJzZUludCIsIkVycm9yIiwicGFyc2VGbG9hdCIsIlRSQUNLSU5HX0VWRU5UX1BPSU5UIiwiTWFwIiwidmFzdCIsImVycm9yVXJscyIsImNvbnN0cnVjdG9yIiwidGhpcyIsImlzV3JhcHBlciIsInZFbGUiLCJxdWVyeVNlbGVjdG9yIiwiYXN5bmMiLCJ2YXN0QWRUYWdVUklFbGUiLCJ0ZXh0Q29udGVudCIsInJlcyIsImZldGNoIiwidGV4dCIsInNvdXJjZVZhc3QiLCJ2YXN0RWxlIiwicGFyc2VWYXN0WE1MIiwiaSIsIm5leHRWYXN0IiwiY3JlYXRlVmFzdE9iamVjdCIsImUiLCJ4bWxEb2MiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJwYXJzZXJFcnJvciIsInJvb3RFcnJvckVsZSIsInB1c2giLCJpbmxpbmVFbGUiLCJOb1ZBU1RSZXNwb25zZUFmdGVyV3JhcHBlciIsImVycm9yRWxlIiwiaW1wRWxlIiwiWE1MUGFyc2VFcnJvciIsImltcHJlc3Npb25VcmwiLCJhZFRpdGxlRWxlIiwiYWRUaXRsZSIsImFkRGVzYyIsImFkRGVzY0VsZSIsImxpbmVhckVsZSIsImR1cmF0aW9uRWxlIiwiZHVyYXRpb24iLCJ0cmFja2luZ3NFbGVzIiwicXVlcnlTZWxlY3RvckFsbCIsInRyYWNraW5nTWFwIiwiY3JlYXRlVHJhY2tpbmdPYmplY3QiLCJpY29uRWxlcyIsImljb25PYmplY3RzIiwiY3JlYXRlSWNvbk9iamVjdCIsIm1lZGlhRmlsZUVsZXMiLCJtZWRpYUZpbGVVcmwiLCJ2aWRlb0NsaWNrc0VsZSIsImNsaWNrVGhyb3VnaFVybCIsImNsaWNrVHJhY2tpbmdVcmxzIiwiY2xpY2tUaHJvdWdoRWxlIiwiY2xpY2tUcmFja2luZ0VsZXMiLCJjbGlja1RyYWNraW5nRWxlIiwiaW1wcmVzc2lvblVybHMiLCJ0cmFja2luZ3MiLCJpY29ucyIsInRyYWNraW5nRWxlcyIsImZvckVhY2giLCJ0cmFja2luZyIsImV2ZW50IiwiZ2V0QXR0cmlidXRlIiwib2Zmc2V0Iiwib2Zmc2V0U2Vjb25kIiwic2V0IiwiZXZlbnRfcG9pbnQiLCJnZXQiLCJ1bmRlZmluZWQiLCJpY29uIiwiaWNvbkVsZSIsIndpZHRoIiwiaGVpZ2h0IiwieCIsInhQb3NpdGlvbiIsInkiLCJ5UG9zaXRpb24iLCJzdGFydCIsImVuZCIsInN0YXRpY1Jlc291cmNlIiwiaWNvbkNsaWNrVGhyb3VnaCIsImljb25DbGlja1RyYWNraW5nIiwiaW1nVXJsIiwiY2xpY2tUcmFja2luZ1VybCIsInZhc3RFeGVjdXRvciIsInZhc3RPYmplY3QiLCJpZnJhbWUiLCJib3JkZXIiLCJnZXRFbGVtZW50QnlJZCIsImFwcGVuZENoaWxkIiwiaURvYyIsImNvbnRlbnRXaW5kb3ciLCJvcGVuIiwid3JpdGUiLCJjbG9zZSIsImRvY3VtZW50RWxlbWVudCIsIm92ZXJmbG93IiwiYWREZXNjRGl2IiwidmFzdFZpZGVvRGl2IiwidmlkZW8iLCJtdXRlZCIsImF1dG9wbGF5IiwiYWRkRXZlbnRMaXN0ZW5lciIsInByb2dyZXNzYmFyIiwiYmFyQW5pbWF0aW9uTG9vcCIsInByb2dyZXNzUG9pbnQiLCJjdXJyZW50VGltZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInZpZGVvUGFyZW50IiwicmVwbGFjZU1hcCIsInRvSVNPU3RyaW5nIiwiaW52aWV3UmF0aW9NZ3IiLCJyYXRpbyIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiZW50cmllcyIsImVudHJ5IiwiTWF0aCIsImZsb29yIiwiaW50ZXJzZWN0aW9uUmF0aW8iLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwib2JzZXJ2ZSIsInRvRml4ZWQiLCJnZXRJbnZpZXdSYXRpbyIsInRhcmdldCIsInZhbHVlIiwia2V5Iiwib25jZSIsInNldEltcHJlc3Npb25VcmwiLCJzZXRWaWRlb0NsaWNrVGhyb3VnaFVybCIsInNldFZpZGVvQ2xpY2tUcmFja2luZ1VybHMiLCJwb2ludCIsInRpbWVCZWFjb25FdmVudCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRUcmFja2luZ1VybHMiLCJpY29uUGFyZW50IiwiaWNvbk9iaiIsInBvc2l0aW9uIiwibGVmdCIsInJpZ2h0IiwidG9wIiwiYm90dG9tIiwidGltZUljb25FdmVudCIsImNvbnRhaW5zIiwicmVtb3ZlQ2hpbGQiLCJpc0ludGVyc2VjdGluZyIsInBsYXkiLCJwYXVzZSIsIndpbmRvdyJdLCJzb3VyY2VSb290IjoiIn0=