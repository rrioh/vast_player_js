(()=>{"use strict";function e(e){let t=e.match(/(\d{2}):(\d{2}):(\d{2})/);if(!t||t.length<4||NaN===parseInt(t[1])||NaN===parseInt(t[2])||NaN===parseInt(t[3]))throw new Error("convertdurationToSecond error: "+e);return 60*parseInt(t[1])*60+60*parseInt(t[2])+parseInt(t[3])}const t=new Map([["start",0],["firstQuartile",1/4],["midpoint",.5],["thirdQuartile",3/4],["complete",1]]),n=new class{parseVast(e){let t=this.parseVastXML(e);return this.createVastObject(t)}parseVastXML(e){let t=(new DOMParser).parseFromString(e,"application/xml");if(t.querySelector("parsererror"))throw new Error("cannot parse VAST");let n=t.querySelector("VAST");if(!n)throw new Error("VAST tag not found");return n}createVastObject(t){const n=t.querySelector(":scope>Ad>InLine");if(!n)throw new Error("cannot parse InLine");const i=n.querySelector(":scope>Error");if(!i||!i.textContent)throw new Error("cannot parse InLine Error");const r=i.textContent,o=n.querySelector(":scope>Impression");if(!o||!o.textContent)throw new Error("cannot parse InLine Impression");const a=o.textContent,s=n.querySelector(":scope>AdTitle");if(!s||!s.textContent)throw new Error("cannot parse InLine AdTitle");const c=s.textContent,l=n.querySelector(":scope>Creatives>Creative>Linear");if(!l)throw new Error("cannot parse InLine Linear");const d=l.querySelector(":scope>Duration");if(!d||!d.textContent)throw new Error("cannot parse InLine Linear Duration");const p=e(d.textContent),T=l.querySelectorAll(":scope>TrackingEvents>Tracking"),m=this.createTrackingObject(T,p),h=l.querySelectorAll(":scope>MediaFiles>MediaFile");if(!h)throw new Error("cannot parse MediaFiles");const u=h[0]?.textContent,g=l.querySelector(":scope>VideoClicks>ClickThrough");if(!g||!g.textContent)throw new Error("cannot parse InLine Linear ClickThrough");return{errorUrl:r,impressionUrls:[a],adTitle:c,trackingMap:m,mediaFileUrl:u,clickThroughUrl:g.textContent}}createTrackingObject(n,i){const r=new Map;return n.forEach((function(n){if(!n.textContent)return;const o=n.getAttribute("event");if(o)if("progress"===o){const t=n.getAttribute("offset");if(!t)return;const i=e(t);r.set(i,n.textContent)}else{const e=t.get(o);null!=e&&r.set(e*i,n.textContent)}})),r}};const i=new class{startPlayer(e){console.log("setPlayer started...");const t=n.parseVast('\n<VAST version="4.2">\n  <Ad id="1b330e59-3a62-4000-b9fb-ac9726e98c52" sequence="1">\n    <InLine>\n      <AdSystem version="2.0">nend</AdSystem>\n      <AdTitle><![CDATA[スマートフォンアドネットワーク「nend」]]></AdTitle>\n      <Description><![CDATA[静止画バナーから動画リワード/動画インターステイシャル/動画ネイティブに対応しています]]></Description>\n      <Advertiser><![CDATA[株式会社ファンコミュニケーションズ]]></Advertiser>\n      <Error><![CDATA[https://inline.test.example/error?code=[ERRORCODE]&clientTime=[TIMESTAMP]]]></Error>\n      <Impression id="nend"><![CDATA[https://inline.test.example/impression?clientTime=[TIMESTAMP]]]></Impression>\n      <Creatives>\n        <Creative adId="7245" sequence="1">\n          <Linear>\n            <Duration>00:00:15</Duration>\n            <MediaFiles>\n              <MediaFile delivery="progressive" type="video/mp4" width="1920" height="1080"><![CDATA[https://s3-ap-northeast-1.amazonaws.com/adstir-stage-js/video/AdStir-MOVIE-JP-15.mp4]]></MediaFile>\n            </MediaFiles>\n            <VideoClicks>\n              <ClickThrough><![CDATA[https://mt.united.jp?is=test]]></ClickThrough>\n              <ClickTracking><![CDATA[https://inline.test.example/videoclicktracking?clientTime=[TIMESTAMP]]]></ClickTracking>\n            </VideoClicks>\n            <Icons>\n              <Icon program="nend" width="10" height="10" xPosition="right" yPosition="top">\n                <StaticResource creativeType="image/png"><![CDATA[https://s3-ap-northeast-1.amazonaws.com/adstir-stage-js/optout/i1.png]]></StaticResource>\n                <IconClicks>\n                  <IconClickThrough><![CDATA[https://ja.ad-stir.com/sp/optout.html]]></IconClickThrough>\n                </IconClicks>\n              </Icon>\n            </Icons>\n            <TrackingEvents>\n              <Tracking event="pause"><![CDATA[https://inline.test.example/pause?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="skip"><![CDATA[https://inline.test.example/skip?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="start"><![CDATA[https://inline.test.example/start?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="firstQuartile"><![CDATA[https://inline.test.example/firstQuartile?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="midpoint"><![CDATA[https://inline.test.example/midpoint?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="thirdQuartile"><![CDATA[https://inline.test.example/thirdQuartile?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="complete"><![CDATA[https://inline.test.example/complete?clientTime=[TIMESTAMP]]]></Tracking>\n              <Tracking event="complete"><![CDATA[https://inline.test.example/complete2?clientTime=[TIMESTAMP]]]></Tracking>\n            </TrackingEvents>\n          </Linear>\n        </Creative>\n      </Creatives>\n    </InLine>\n  </Ad>\n</VAST>\n');let i=document.createElement("iframe");i.width="300px",i.height="250px",i.style.border="none",document.getElementById("playerbox")?.appendChild(i);let r=i.contentWindow.document;r.open(),r.write('\n<!DOCTYPE html>\n<html>\n    <head>\n    </head>\n    <body style="margin:0;">\n        <div id="vast_video_container">\n            <div id="vast_video" style="width:300px;height:168.75px;"></div>\n            <div id="progress_bar" style="width:50%;height:2px;background-color:gray;"></div>\n            <div id="ad_title" style="margin:0;width:298px;height:77.25px;background-color:#dcdcdc;"></div>\n        </div>\n    </body>\n</html>\n'),r.close(),r.documentElement.style.overflow="hidden",r.getElementById("ad_title").textContent=t.adTitle;let o=r.getElementById("vast_video"),a=document.createElement("video");a.src=t.mediaFileUrl,a.width=300,a.height=168.75,a.muted=!0,a.autoplay=!0,a.addEventListener("loadedmetadata",(function(e){let t=r.getElementById("progress_bar"),n=function(){let e=a.currentTime/a.duration*100;t.style.width=e+"%",requestAnimationFrame(n)};requestAnimationFrame(n)})),function(e,t){!function(e,t){for(let n of t)e.addEventListener("canplay",(function(t){let i=document.createElement("img");i.src=n,i.style.display="none",e.parentNode?.appendChild(i)}),{once:!0})}(e,t.impressionUrls),function(e,t){e.addEventListener("click",(function(e){open(t,"_blank")}))}(e,t.clickThroughUrl),function(e,t){e.addEventListener("loadedmetadata",(function(n){for(let[n,i]of t.trackingMap){let t=function(){if(e.currentTime>=n){let t=document.createElement("img");return t.src=i,t.style.display="none",e.parentNode?.appendChild(t),void console.log("[DEBUG] tracking beacon sent: "+i)}requestAnimationFrame(t)};requestAnimationFrame(t)}}))}(e,t)}(a,t),o.appendChild(a)}};window.vastExecutor=window.vastExecutor||i})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGlCQUFpQixXQUFXLFNBQVVDLEdBQ3hDLElBQUlRLEVBQU03QixTQUFTQyxjQUFjLE9BQ2pDNEIsRUFBSVosSUFBTVcsRUFDVkMsRUFBSXpCLE1BQU0wQixRQUFVLE9BQ3BCZCxFQUFNZSxZQUFZeEIsWUFBWXNCLEtBQy9CLENBQUVHLE1BQU0sSUEyQmZDLENBQWlCakIsRUFBT2xCLEVBQVdoQixnQkF4QnZDLFNBQWlDa0MsRUFBT1ksR0FDcENaLEVBQU1JLGlCQUFpQixTQUFTLFNBQVVDLEdBQ3RDWCxLQUFLa0IsRUFBSyxhQXVCZE0sQ0FBd0JsQixFQUFPbEIsRUFBV2YsaUJBcEI5QyxTQUF5QmlDLEVBQU9sQixHQUM1QmtCLEVBQU1JLGlCQUFpQixrQkFBa0IsU0FBVUMsR0FDL0MsSUFBSyxJQUFLYyxFQUFPUCxLQUFROUIsRUFBV3JCLFlBQWEsQ0FDN0MsSUFBSTJELEVBQU8sV0FDUCxHQUFJcEIsRUFBTVMsYUFBZVUsRUFBTyxDQUM1QixJQUFJTixFQUFNN0IsU0FBU0MsY0FBYyxPQUtqQyxPQUpBNEIsRUFBSVosSUFBTVcsRUFDVkMsRUFBSXpCLE1BQU0wQixRQUFVLE9BQ3BCZCxFQUFNZSxZQUFZeEIsWUFBWXNCLFFBQzlCakMsUUFBUUMsSUFBSSxpQ0FBbUMrQixHQUduREYsc0JBQXNCVSxJQUUxQlYsc0JBQXNCVSxPQU85QkMsQ0FBZ0JyQixFQUFPbEIsR0QyRG5Cd0MsQ0FBV3RCLEVBQU9sQixHQUNsQmlCLEVBQWFSLFlBQVlTLEtBSWpDdUIsT0FBTzdDLGFBQWU2QyxPQUFPN0MsY0FBZ0JBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92YXN0X3BsYXllcl9qcy8uL2xpYi91dGlsLnRzIiwid2VicGFjazovL3Zhc3RfcGxheWVyX2pzLy4vbGliL3Zhc3QudHMiLCJ3ZWJwYWNrOi8vdmFzdF9wbGF5ZXJfanMvLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly92YXN0X3BsYXllcl9qcy8uL2xpYi9iZWFjb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRUaW1lVG9TZWNvbmQoZHVyYXRpb25TdHIpIHtcbiAgICBsZXQgcmVzdWx0ID0gZHVyYXRpb25TdHIubWF0Y2goLyhcXGR7Mn0pOihcXGR7Mn0pOihcXGR7Mn0pLyk7XG4gICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA8IDQgfHwgcGFyc2VJbnQocmVzdWx0WzFdKSA9PT0gTmFOIHx8IHBhcnNlSW50KHJlc3VsdFsyXSkgPT09IE5hTiB8fCBwYXJzZUludChyZXN1bHRbM10pID09PSBOYU4pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29udmVydGR1cmF0aW9uVG9TZWNvbmQgZXJyb3I6IFwiICsgZHVyYXRpb25TdHIpO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VJbnQocmVzdWx0WzFdKSAqIDYwICogNjAgKyBwYXJzZUludChyZXN1bHRbMl0pICogNjAgKyBwYXJzZUludChyZXN1bHRbM10pO1xufVxuIiwiaW1wb3J0IHsgY29udmVydFRpbWVUb1NlY29uZCB9IGZyb20gXCIuL3V0aWxcIjtcbmNvbnN0IFRSQUNLSU5HX0VWRU5UX1BPSU5UID0gbmV3IE1hcChbXG4gICAgW1wic3RhcnRcIiwgMF0sXG4gICAgW1wiZmlyc3RRdWFydGlsZVwiLCAxIC8gNF0sXG4gICAgW1wibWlkcG9pbnRcIiwgMSAvIDJdLFxuICAgIFtcInRoaXJkUXVhcnRpbGVcIiwgMyAvIDRdLFxuICAgIFtcImNvbXBsZXRlXCIsIDFdXG5dKTtcbmNsYXNzIFZhc3Qge1xuICAgIHBhcnNlVmFzdChzb3VyY2VWYXN0KSB7XG4gICAgICAgIGxldCB2YXN0RG9jID0gdGhpcy5wYXJzZVZhc3RYTUwoc291cmNlVmFzdCk7XG4gICAgICAgIGNvbnN0IHZhc3RPYmplY3QgPSB0aGlzLmNyZWF0ZVZhc3RPYmplY3QodmFzdERvYyk7XG4gICAgICAgIHJldHVybiB2YXN0T2JqZWN0O1xuICAgIH1cbiAgICBwYXJzZVZhc3RYTUwoc291cmNlVmFzdCkge1xuICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgIGxldCB4bWxEb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHNvdXJjZVZhc3QsIFwiYXBwbGljYXRpb24veG1sXCIpO1xuICAgICAgICBsZXQgcGFyc2VyRXJyb3IgPSB4bWxEb2MucXVlcnlTZWxlY3RvcihcInBhcnNlcmVycm9yXCIpO1xuICAgICAgICBpZiAocGFyc2VyRXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNhbm5vdCBwYXJzZSBWQVNUXCIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCB2YXN0RG9jID0geG1sRG9jLnF1ZXJ5U2VsZWN0b3IoXCJWQVNUXCIpO1xuICAgICAgICBpZiAoIXZhc3REb2MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlZBU1QgdGFnIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFzdERvYztcbiAgICB9XG4gICAgY3JlYXRlVmFzdE9iamVjdCh2ZG9jKSB7XG4gICAgICAgIGNvbnN0IGlubGluZURvYyA9IHZkb2MucXVlcnlTZWxlY3RvcihcIjpzY29wZT5BZD5JbkxpbmVcIik7XG4gICAgICAgIGlmICghaW5saW5lRG9jKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjYW5ub3QgcGFyc2UgSW5MaW5lXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVycm9yRG9jID0gaW5saW5lRG9jLnF1ZXJ5U2VsZWN0b3IoXCI6c2NvcGU+RXJyb3JcIik7XG4gICAgICAgIGlmICghZXJyb3JEb2MgfHwgIWVycm9yRG9jLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjYW5ub3QgcGFyc2UgSW5MaW5lIEVycm9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVycm9yVXJsID0gZXJyb3JEb2MudGV4dENvbnRlbnQ7XG4gICAgICAgIGNvbnN0IGltcERvYyA9IGlubGluZURvYy5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPkltcHJlc3Npb25cIik7XG4gICAgICAgIGlmICghaW1wRG9jIHx8ICFpbXBEb2MudGV4dENvbnRlbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNhbm5vdCBwYXJzZSBJbkxpbmUgSW1wcmVzc2lvblwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbXByZXNzaW9uVXJsID0gaW1wRG9jLnRleHRDb250ZW50O1xuICAgICAgICBjb25zdCBhZFRpdGxlRG9jID0gaW5saW5lRG9jLnF1ZXJ5U2VsZWN0b3IoXCI6c2NvcGU+QWRUaXRsZVwiKTtcbiAgICAgICAgaWYgKCFhZFRpdGxlRG9jIHx8ICFhZFRpdGxlRG9jLnRleHRDb250ZW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjYW5ub3QgcGFyc2UgSW5MaW5lIEFkVGl0bGVcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWRUaXRsZSA9IGFkVGl0bGVEb2MudGV4dENvbnRlbnQ7XG4gICAgICAgIGNvbnN0IGxpbmVhckRvYyA9IGlubGluZURvYy5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPkNyZWF0aXZlcz5DcmVhdGl2ZT5MaW5lYXJcIik7XG4gICAgICAgIGlmICghbGluZWFyRG9jKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjYW5ub3QgcGFyc2UgSW5MaW5lIExpbmVhclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkdXJhdGlvbkRvYyA9IGxpbmVhckRvYy5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPkR1cmF0aW9uXCIpO1xuICAgICAgICBpZiAoIWR1cmF0aW9uRG9jIHx8ICFkdXJhdGlvbkRvYy50ZXh0Q29udGVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY2Fubm90IHBhcnNlIEluTGluZSBMaW5lYXIgRHVyYXRpb25cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBjb252ZXJ0VGltZVRvU2Vjb25kKGR1cmF0aW9uRG9jLnRleHRDb250ZW50KTtcbiAgICAgICAgY29uc3QgdHJhY2tpbmdzRG9jID0gbGluZWFyRG9jLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6c2NvcGU+VHJhY2tpbmdFdmVudHM+VHJhY2tpbmdcIik7XG4gICAgICAgIGNvbnN0IHRyYWNraW5nTWFwID0gdGhpcy5jcmVhdGVUcmFja2luZ09iamVjdCh0cmFja2luZ3NEb2MsIGR1cmF0aW9uKTtcbiAgICAgICAgY29uc3QgbWVkaWFGaWxlc0RvYyA9IGxpbmVhckRvYy5xdWVyeVNlbGVjdG9yQWxsKFwiOnNjb3BlPk1lZGlhRmlsZXM+TWVkaWFGaWxlXCIpO1xuICAgICAgICBpZiAoIW1lZGlhRmlsZXNEb2MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNhbm5vdCBwYXJzZSBNZWRpYUZpbGVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIOOBsuOBqOOBvuOBmjHjgaTnm67jga5NZWRpYUZpbGXjga5VUkzjga7jgb/lj5blvpdcbiAgICAgICAgY29uc3QgbWVkaWFGaWxlVXJsID0gbWVkaWFGaWxlc0RvY1swXT8udGV4dENvbnRlbnQ7XG4gICAgICAgIGNvbnN0IGNsaWNrVGhyb3VnaERvYyA9IGxpbmVhckRvYy5xdWVyeVNlbGVjdG9yKFwiOnNjb3BlPlZpZGVvQ2xpY2tzPkNsaWNrVGhyb3VnaFwiKTtcbiAgICAgICAgaWYgKCFjbGlja1Rocm91Z2hEb2MgfHwgIWNsaWNrVGhyb3VnaERvYy50ZXh0Q29udGVudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY2Fubm90IHBhcnNlIEluTGluZSBMaW5lYXIgQ2xpY2tUaHJvdWdoXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNsaWNrVGhyb3VnaFVybCA9IGNsaWNrVGhyb3VnaERvYy50ZXh0Q29udGVudDtcbiAgICAgICAgY29uc3QgdmFzdE9iamVjdCA9IHtcbiAgICAgICAgICAgIGVycm9yVXJsOiBlcnJvclVybCxcbiAgICAgICAgICAgIGltcHJlc3Npb25VcmxzOiBbaW1wcmVzc2lvblVybF0sXG4gICAgICAgICAgICBhZFRpdGxlOiBhZFRpdGxlLFxuICAgICAgICAgICAgdHJhY2tpbmdNYXA6IHRyYWNraW5nTWFwLFxuICAgICAgICAgICAgbWVkaWFGaWxlVXJsOiBtZWRpYUZpbGVVcmwsXG4gICAgICAgICAgICBjbGlja1Rocm91Z2hVcmw6IGNsaWNrVGhyb3VnaFVybFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdmFzdE9iamVjdDtcbiAgICB9XG4gICAgY3JlYXRlVHJhY2tpbmdPYmplY3QodHJhY2tpbmdzRG9jLCBkdXJhdGlvbikge1xuICAgICAgICBjb25zdCB0cmFja2luZ01hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdHJhY2tpbmdzRG9jLmZvckVhY2goZnVuY3Rpb24gKHRyYWNraW5nKSB7XG4gICAgICAgICAgICBpZiAoIXRyYWNraW5nLnRleHRDb250ZW50KVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gdHJhY2tpbmcuZ2V0QXR0cmlidXRlKFwiZXZlbnRcIik7XG4gICAgICAgICAgICBpZiAoIWV2ZW50KVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGlmIChldmVudCA9PT0gXCJwcm9ncmVzc1wiKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdHJhY2tpbmcuZ2V0QXR0cmlidXRlKFwib2Zmc2V0XCIpO1xuICAgICAgICAgICAgICAgIGlmICghb2Zmc2V0KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0U2Vjb25kID0gY29udmVydFRpbWVUb1NlY29uZChvZmZzZXQpO1xuICAgICAgICAgICAgICAgIHRyYWNraW5nTWFwLnNldChvZmZzZXRTZWNvbmQsIHRyYWNraW5nLnRleHRDb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50X3BvaW50ID0gVFJBQ0tJTkdfRVZFTlRfUE9JTlQuZ2V0KGV2ZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnRfcG9pbnQgIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICB0cmFja2luZ01hcC5zZXQoZXZlbnRfcG9pbnQgKiBkdXJhdGlvbiwgdHJhY2tpbmcudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRyYWNraW5nTWFwO1xuICAgIH1cbn1cbmNvbnN0IHZhc3QgPSBuZXcgVmFzdCgpO1xuZXhwb3J0IGRlZmF1bHQgdmFzdDtcbiIsImltcG9ydCB2YXN0IGZyb20gXCIuLi9saWIvdmFzdFwiO1xuaW1wb3J0IHsgc2V0QmVhY29ucyB9IGZyb20gXCIuLi9saWIvYmVhY29uXCI7XG5jb25zdCBjb250YWluZXIgPSBgXG48IURPQ1RZUEUgaHRtbD5cbjxodG1sPlxuICAgIDxoZWFkPlxuICAgIDwvaGVhZD5cbiAgICA8Ym9keSBzdHlsZT1cIm1hcmdpbjowO1wiPlxuICAgICAgICA8ZGl2IGlkPVwidmFzdF92aWRlb19jb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgaWQ9XCJ2YXN0X3ZpZGVvXCIgc3R5bGU9XCJ3aWR0aDozMDBweDtoZWlnaHQ6MTY4Ljc1cHg7XCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGlkPVwicHJvZ3Jlc3NfYmFyXCIgc3R5bGU9XCJ3aWR0aDo1MCU7aGVpZ2h0OjJweDtiYWNrZ3JvdW5kLWNvbG9yOmdyYXk7XCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGlkPVwiYWRfdGl0bGVcIiBzdHlsZT1cIm1hcmdpbjowO3dpZHRoOjI5OHB4O2hlaWdodDo3Ny4yNXB4O2JhY2tncm91bmQtY29sb3I6I2RjZGNkYztcIj48L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9ib2R5PlxuPC9odG1sPlxuYDtcbmNvbnN0IGlubGluZVZhc3RTYW1wbGUgPSBgXG48VkFTVCB2ZXJzaW9uPVwiNC4yXCI+XG4gIDxBZCBpZD1cIjFiMzMwZTU5LTNhNjItNDAwMC1iOWZiLWFjOTcyNmU5OGM1MlwiIHNlcXVlbmNlPVwiMVwiPlxuICAgIDxJbkxpbmU+XG4gICAgICA8QWRTeXN0ZW0gdmVyc2lvbj1cIjIuMFwiPm5lbmQ8L0FkU3lzdGVtPlxuICAgICAgPEFkVGl0bGU+PCFbQ0RBVEFb44K544Oe44O844OI44OV44Kp44Oz44Ki44OJ44ON44OD44OI44Ov44O844Kv44CMbmVuZOOAjV1dPjwvQWRUaXRsZT5cbiAgICAgIDxEZXNjcmlwdGlvbj48IVtDREFUQVvpnZnmraLnlLvjg5Djg4rjg7zjgYvjgonli5XnlLvjg6rjg6/jg7zjg4kv5YuV55S744Kk44Oz44K/44O844K544OG44Kk44K344Oj44OrL+WLleeUu+ODjeOCpOODhuOCo+ODluOBq+WvvuW/nOOBl+OBpuOBhOOBvuOBmV1dPjwvRGVzY3JpcHRpb24+XG4gICAgICA8QWR2ZXJ0aXNlcj48IVtDREFUQVvmoKrlvI/kvJrnpL7jg5XjgqHjg7PjgrPjg5/jg6Xjg4vjgrHjg7zjgrfjg6fjg7PjgrpdXT48L0FkdmVydGlzZXI+XG4gICAgICA8RXJyb3I+PCFbQ0RBVEFbaHR0cHM6Ly9pbmxpbmUudGVzdC5leGFtcGxlL2Vycm9yP2NvZGU9W0VSUk9SQ09ERV0mY2xpZW50VGltZT1bVElNRVNUQU1QXV1dPjwvRXJyb3I+XG4gICAgICA8SW1wcmVzc2lvbiBpZD1cIm5lbmRcIj48IVtDREFUQVtodHRwczovL2lubGluZS50ZXN0LmV4YW1wbGUvaW1wcmVzc2lvbj9jbGllbnRUaW1lPVtUSU1FU1RBTVBdXV0+PC9JbXByZXNzaW9uPlxuICAgICAgPENyZWF0aXZlcz5cbiAgICAgICAgPENyZWF0aXZlIGFkSWQ9XCI3MjQ1XCIgc2VxdWVuY2U9XCIxXCI+XG4gICAgICAgICAgPExpbmVhcj5cbiAgICAgICAgICAgIDxEdXJhdGlvbj4wMDowMDoxNTwvRHVyYXRpb24+XG4gICAgICAgICAgICA8TWVkaWFGaWxlcz5cbiAgICAgICAgICAgICAgPE1lZGlhRmlsZSBkZWxpdmVyeT1cInByb2dyZXNzaXZlXCIgdHlwZT1cInZpZGVvL21wNFwiIHdpZHRoPVwiMTkyMFwiIGhlaWdodD1cIjEwODBcIj48IVtDREFUQVtodHRwczovL3MzLWFwLW5vcnRoZWFzdC0xLmFtYXpvbmF3cy5jb20vYWRzdGlyLXN0YWdlLWpzL3ZpZGVvL0FkU3Rpci1NT1ZJRS1KUC0xNS5tcDRdXT48L01lZGlhRmlsZT5cbiAgICAgICAgICAgIDwvTWVkaWFGaWxlcz5cbiAgICAgICAgICAgIDxWaWRlb0NsaWNrcz5cbiAgICAgICAgICAgICAgPENsaWNrVGhyb3VnaD48IVtDREFUQVtodHRwczovL210LnVuaXRlZC5qcD9pcz10ZXN0XV0+PC9DbGlja1Rocm91Z2g+XG4gICAgICAgICAgICAgIDxDbGlja1RyYWNraW5nPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS92aWRlb2NsaWNrdHJhY2tpbmc/Y2xpZW50VGltZT1bVElNRVNUQU1QXV1dPjwvQ2xpY2tUcmFja2luZz5cbiAgICAgICAgICAgIDwvVmlkZW9DbGlja3M+XG4gICAgICAgICAgICA8SWNvbnM+XG4gICAgICAgICAgICAgIDxJY29uIHByb2dyYW09XCJuZW5kXCIgd2lkdGg9XCIxMFwiIGhlaWdodD1cIjEwXCIgeFBvc2l0aW9uPVwicmlnaHRcIiB5UG9zaXRpb249XCJ0b3BcIj5cbiAgICAgICAgICAgICAgICA8U3RhdGljUmVzb3VyY2UgY3JlYXRpdmVUeXBlPVwiaW1hZ2UvcG5nXCI+PCFbQ0RBVEFbaHR0cHM6Ly9zMy1hcC1ub3J0aGVhc3QtMS5hbWF6b25hd3MuY29tL2Fkc3Rpci1zdGFnZS1qcy9vcHRvdXQvaTEucG5nXV0+PC9TdGF0aWNSZXNvdXJjZT5cbiAgICAgICAgICAgICAgICA8SWNvbkNsaWNrcz5cbiAgICAgICAgICAgICAgICAgIDxJY29uQ2xpY2tUaHJvdWdoPjwhW0NEQVRBW2h0dHBzOi8vamEuYWQtc3Rpci5jb20vc3Avb3B0b3V0Lmh0bWxdXT48L0ljb25DbGlja1Rocm91Z2g+XG4gICAgICAgICAgICAgICAgPC9JY29uQ2xpY2tzPlxuICAgICAgICAgICAgICA8L0ljb24+XG4gICAgICAgICAgICA8L0ljb25zPlxuICAgICAgICAgICAgPFRyYWNraW5nRXZlbnRzPlxuICAgICAgICAgICAgICA8VHJhY2tpbmcgZXZlbnQ9XCJwYXVzZVwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS9wYXVzZT9jbGllbnRUaW1lPVtUSU1FU1RBTVBdXV0+PC9UcmFja2luZz5cbiAgICAgICAgICAgICAgPFRyYWNraW5nIGV2ZW50PVwic2tpcFwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS9za2lwP2NsaWVudFRpbWU9W1RJTUVTVEFNUF1dXT48L1RyYWNraW5nPlxuICAgICAgICAgICAgICA8VHJhY2tpbmcgZXZlbnQ9XCJzdGFydFwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS9zdGFydD9jbGllbnRUaW1lPVtUSU1FU1RBTVBdXV0+PC9UcmFja2luZz5cbiAgICAgICAgICAgICAgPFRyYWNraW5nIGV2ZW50PVwiZmlyc3RRdWFydGlsZVwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS9maXJzdFF1YXJ0aWxlP2NsaWVudFRpbWU9W1RJTUVTVEFNUF1dXT48L1RyYWNraW5nPlxuICAgICAgICAgICAgICA8VHJhY2tpbmcgZXZlbnQ9XCJtaWRwb2ludFwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS9taWRwb2ludD9jbGllbnRUaW1lPVtUSU1FU1RBTVBdXV0+PC9UcmFja2luZz5cbiAgICAgICAgICAgICAgPFRyYWNraW5nIGV2ZW50PVwidGhpcmRRdWFydGlsZVwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS90aGlyZFF1YXJ0aWxlP2NsaWVudFRpbWU9W1RJTUVTVEFNUF1dXT48L1RyYWNraW5nPlxuICAgICAgICAgICAgICA8VHJhY2tpbmcgZXZlbnQ9XCJjb21wbGV0ZVwiPjwhW0NEQVRBW2h0dHBzOi8vaW5saW5lLnRlc3QuZXhhbXBsZS9jb21wbGV0ZT9jbGllbnRUaW1lPVtUSU1FU1RBTVBdXV0+PC9UcmFja2luZz5cbiAgICAgICAgICAgICAgPFRyYWNraW5nIGV2ZW50PVwiY29tcGxldGVcIj48IVtDREFUQVtodHRwczovL2lubGluZS50ZXN0LmV4YW1wbGUvY29tcGxldGUyP2NsaWVudFRpbWU9W1RJTUVTVEFNUF1dXT48L1RyYWNraW5nPlxuICAgICAgICAgICAgPC9UcmFja2luZ0V2ZW50cz5cbiAgICAgICAgICA8L0xpbmVhcj5cbiAgICAgICAgPC9DcmVhdGl2ZT5cbiAgICAgIDwvQ3JlYXRpdmVzPlxuICAgIDwvSW5MaW5lPlxuICA8L0FkPlxuPC9WQVNUPlxuYDtcbmNsYXNzIFZhc3RFeGVjdXRvciB7XG4gICAgc3RhcnRQbGF5ZXIoc291cmNlVmFzdCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcInNldFBsYXllciBzdGFydGVkLi4uXCIpO1xuICAgICAgICBzb3VyY2VWYXN0ID0gaW5saW5lVmFzdFNhbXBsZTtcbiAgICAgICAgY29uc3QgdmFzdE9iamVjdCA9IHZhc3QucGFyc2VWYXN0KHNvdXJjZVZhc3QpO1xuICAgICAgICBsZXQgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcbiAgICAgICAgaWZyYW1lLndpZHRoID0gXCIzMDBweFwiO1xuICAgICAgICBpZnJhbWUuaGVpZ2h0ID0gXCIyNTBweFwiO1xuICAgICAgICBpZnJhbWUuc3R5bGUuYm9yZGVyID0gXCJub25lXCI7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyYm94XCIpPy5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICBsZXQgaURvYyA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50O1xuICAgICAgICBpRG9jLm9wZW4oKTtcbiAgICAgICAgaURvYy53cml0ZShjb250YWluZXIpO1xuICAgICAgICBpRG9jLmNsb3NlKCk7XG4gICAgICAgIGlEb2MuZG9jdW1lbnRFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICAgICAgbGV0IGFkVGl0bGVEaXYgPSBpRG9jLmdldEVsZW1lbnRCeUlkKFwiYWRfdGl0bGVcIik7XG4gICAgICAgIGFkVGl0bGVEaXYudGV4dENvbnRlbnQgPSB2YXN0T2JqZWN0LmFkVGl0bGU7XG4gICAgICAgIGxldCB2YXN0VmlkZW9EaXYgPSBpRG9jLmdldEVsZW1lbnRCeUlkKFwidmFzdF92aWRlb1wiKTtcbiAgICAgICAgbGV0IHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpO1xuICAgICAgICB2aWRlby5zcmMgPSB2YXN0T2JqZWN0Lm1lZGlhRmlsZVVybDtcbiAgICAgICAgdmlkZW8ud2lkdGggPSAzMDA7XG4gICAgICAgIHZpZGVvLmhlaWdodCA9IDE2OC43NTtcbiAgICAgICAgdmlkZW8ubXV0ZWQgPSB0cnVlO1xuICAgICAgICB2aWRlby5hdXRvcGxheSA9IHRydWU7XG4gICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkZWRtZXRhZGF0YVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgbGV0IHByb2dyZXNzYmFyID0gaURvYy5nZXRFbGVtZW50QnlJZChcInByb2dyZXNzX2JhclwiKTtcbiAgICAgICAgICAgIGxldCBiYXJBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGxldCBwcm9ncmVzc1BvaW50ID0gdmlkZW8uY3VycmVudFRpbWUgLyB2aWRlby5kdXJhdGlvbiAqIDEwMDtcbiAgICAgICAgICAgICAgICBwcm9ncmVzc2Jhci5zdHlsZS53aWR0aCA9IHByb2dyZXNzUG9pbnQgKyBcIiVcIjtcbiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYmFyQW5pbWF0aW9uTG9vcCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGJhckFuaW1hdGlvbkxvb3ApO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0QmVhY29ucyh2aWRlbywgdmFzdE9iamVjdCk7XG4gICAgICAgIHZhc3RWaWRlb0Rpdi5hcHBlbmRDaGlsZCh2aWRlbyk7XG4gICAgfVxufVxuY29uc3QgdmFzdEV4ZWN1dG9yID0gbmV3IFZhc3RFeGVjdXRvcigpO1xud2luZG93LnZhc3RFeGVjdXRvciA9IHdpbmRvdy52YXN0RXhlY3V0b3IgfHwgdmFzdEV4ZWN1dG9yO1xuIiwiZnVuY3Rpb24gc2V0SW1wcmVzc2lvblVybCh2aWRlbywgdXJscykge1xuICAgIGZvciAobGV0IHVybCBvZiB1cmxzKSB7XG4gICAgICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBsZXQgZWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgICAgICAgIGVsZS5zcmMgPSB1cmw7XG4gICAgICAgICAgICBlbGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgdmlkZW8ucGFyZW50Tm9kZT8uYXBwZW5kQ2hpbGQoZWxlKTtcbiAgICAgICAgfSwgeyBvbmNlOiB0cnVlIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNldFZpZGVvQ2xpY2tUaHJvdWdoVXJsKHZpZGVvLCB1cmwpIHtcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgb3Blbih1cmwsIFwiX2JsYW5rXCIpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2V0VHJhY2tpbmdVcmxzKHZpZGVvLCB2YXN0T2JqZWN0KSB7XG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZG1ldGFkYXRhXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGZvciAobGV0IFtwb2ludCwgdXJsXSBvZiB2YXN0T2JqZWN0LnRyYWNraW5nTWFwKSB7XG4gICAgICAgICAgICBsZXQgbG9vcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodmlkZW8uY3VycmVudFRpbWUgPj0gcG9pbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgICAgICAgICAgICAgICAgIGVsZS5zcmMgPSB1cmw7XG4gICAgICAgICAgICAgICAgICAgIGVsZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgICAgIHZpZGVvLnBhcmVudE5vZGU/LmFwcGVuZENoaWxkKGVsZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0RFQlVHXSB0cmFja2luZyBiZWFjb24gc2VudDogXCIgKyB1cmwpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzZXRCZWFjb25zKHZpZGVvLCB2YXN0T2JqZWN0KSB7XG4gICAgc2V0SW1wcmVzc2lvblVybCh2aWRlbywgdmFzdE9iamVjdC5pbXByZXNzaW9uVXJscyk7XG4gICAgc2V0VmlkZW9DbGlja1Rocm91Z2hVcmwodmlkZW8sIHZhc3RPYmplY3QuY2xpY2tUaHJvdWdoVXJsKTtcbiAgICBzZXRUcmFja2luZ1VybHModmlkZW8sIHZhc3RPYmplY3QpO1xufVxuIl0sIm5hbWVzIjpbImNvbnZlcnRUaW1lVG9TZWNvbmQiLCJkdXJhdGlvblN0ciIsInJlc3VsdCIsIm1hdGNoIiwibGVuZ3RoIiwiTmFOIiwicGFyc2VJbnQiLCJFcnJvciIsIlRSQUNLSU5HX0VWRU5UX1BPSU5UIiwiTWFwIiwicGFyc2VWYXN0Iiwic291cmNlVmFzdCIsInZhc3REb2MiLCJ0aGlzIiwicGFyc2VWYXN0WE1MIiwiY3JlYXRlVmFzdE9iamVjdCIsInhtbERvYyIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsInF1ZXJ5U2VsZWN0b3IiLCJ2ZG9jIiwiaW5saW5lRG9jIiwiZXJyb3JEb2MiLCJ0ZXh0Q29udGVudCIsImVycm9yVXJsIiwiaW1wRG9jIiwiaW1wcmVzc2lvblVybCIsImFkVGl0bGVEb2MiLCJhZFRpdGxlIiwibGluZWFyRG9jIiwiZHVyYXRpb25Eb2MiLCJkdXJhdGlvbiIsInRyYWNraW5nc0RvYyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ0cmFja2luZ01hcCIsImNyZWF0ZVRyYWNraW5nT2JqZWN0IiwibWVkaWFGaWxlc0RvYyIsIm1lZGlhRmlsZVVybCIsImNsaWNrVGhyb3VnaERvYyIsImltcHJlc3Npb25VcmxzIiwiY2xpY2tUaHJvdWdoVXJsIiwiZm9yRWFjaCIsInRyYWNraW5nIiwiZXZlbnQiLCJnZXRBdHRyaWJ1dGUiLCJvZmZzZXQiLCJvZmZzZXRTZWNvbmQiLCJzZXQiLCJldmVudF9wb2ludCIsImdldCIsInVuZGVmaW5lZCIsInZhc3RFeGVjdXRvciIsInN0YXJ0UGxheWVyIiwiY29uc29sZSIsImxvZyIsInZhc3RPYmplY3QiLCJpZnJhbWUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ3aWR0aCIsImhlaWdodCIsInN0eWxlIiwiYm9yZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJhcHBlbmRDaGlsZCIsImlEb2MiLCJjb250ZW50V2luZG93Iiwib3BlbiIsIndyaXRlIiwiY2xvc2UiLCJkb2N1bWVudEVsZW1lbnQiLCJvdmVyZmxvdyIsInZhc3RWaWRlb0RpdiIsInZpZGVvIiwic3JjIiwibXV0ZWQiLCJhdXRvcGxheSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJvZ3Jlc3NiYXIiLCJiYXJBbmltYXRpb25Mb29wIiwicHJvZ3Jlc3NQb2ludCIsImN1cnJlbnRUaW1lIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwidXJscyIsInVybCIsImVsZSIsImRpc3BsYXkiLCJwYXJlbnROb2RlIiwib25jZSIsInNldEltcHJlc3Npb25VcmwiLCJzZXRWaWRlb0NsaWNrVGhyb3VnaFVybCIsInBvaW50IiwibG9vcCIsInNldFRyYWNraW5nVXJscyIsInNldEJlYWNvbnMiLCJ3aW5kb3ciXSwic291cmNlUm9vdCI6IiJ9